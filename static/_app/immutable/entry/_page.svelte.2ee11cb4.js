import{S as he,i as me,s as pe,k as g,q as G,a as M,e as x,l as k,m as E,r as C,h as i,c as U,n as c,b as V,G as u,J as Q,K as H,L as ve,u as Z,H as W,M as be,N as oe,y as ge,z as ke,A as ye,g as Ee,d as Ie,B as we}from"../chunks/index.259c4853.js";function ie(n,e,t){const l=n.slice();return l[18]=e[t].id,l[19]=e[t].source,l[20]=e[t].text,l}function ue(n,e,t){const l=n.slice();return l[23]=e[t],l[25]=t,l}function Te(n){let e,t;return{c(){e=g("div"),t=g("input"),this.h()},l(l){e=k(l,"DIV",{class:!0});var r=E(e);t=k(r,"INPUT",{type:!0,class:!0}),r.forEach(i),this.h()},h(){c(t,"type","submit"),t.value="Join Game",c(t,"class","horizontal-submit"),c(e,"class","column")},m(l,r){V(l,e,r),u(e,t)},p:W,d(l){l&&i(e)}}}function De(n){let e,t,l,r,a;return{c(){e=g("div"),t=g("button"),l=G("Leave Game"),this.h()},l(d){e=k(d,"DIV",{class:!0});var _=E(e);t=k(_,"BUTTON",{type:!0,class:!0});var o=E(t);l=C(o,"Leave Game"),o.forEach(i),_.forEach(i),this.h()},h(){c(t,"type","button"),c(t,"class","horizontal-submit"),c(e,"class","column")},m(d,_){V(d,e,_),u(e,t),u(t,l),r||(a=H(t,"click",n[9]),r=!0)},p:W,d(d){d&&i(e),r=!1,a()}}}function ce(n){let e,t,l,r,a,d,_,o,h,f,p,b,J,j,I,L,P,Y,A,B,S,F,D;function w(s,O){return s[4]?s[6].winner?Pe:s[6].turn===s[5]?Ve:Ne:Se}let v=w(n),y=v(n),q=n[6].board,T=[];for(let s=0;s<q.length;s+=1)T[s]=fe(ue(n,q,s));let R=n[6].chat,N=[];for(let s=0;s<R.length;s+=1)N[s]=de(ie(n,R,s));return{c(){e=g("div"),y.c(),t=M(),l=g("div"),r=g("div"),a=g("div");for(let s=0;s<T.length;s+=1)T[s].c();d=M(),_=g("div"),o=g("div"),h=g("h2"),f=G("Chat"),p=M(),b=g("div");for(let s=0;s<N.length;s+=1)N[s].c();J=M(),j=g("form"),I=g("div"),L=g("div"),P=g("input"),Y=M(),A=g("div"),B=g("input"),this.h()},l(s){e=k(s,"DIV",{class:!0});var O=E(e);y.l(O),O.forEach(i),t=U(s),l=k(s,"DIV",{class:!0});var m=E(l);r=k(m,"DIV",{class:!0});var z=E(r);a=k(z,"DIV",{class:!0});var ee=E(a);for(let X=0;X<T.length;X+=1)T[X].l(ee);ee.forEach(i),z.forEach(i),d=U(m),_=k(m,"DIV",{class:!0});var te=E(_);o=k(te,"DIV",{id:!0});var K=E(o);h=k(K,"H2",{});var le=E(h);f=C(le,"Chat"),le.forEach(i),p=U(K),b=k(K,"DIV",{class:!0});var ne=E(b);for(let X=0;X<N.length;X+=1)N[X].l(ne);ne.forEach(i),J=U(K),j=k(K,"FORM",{});var re=E(j);I=k(re,"DIV",{class:!0});var $=E(I);L=k($,"DIV",{class:!0});var ae=E(L);P=k(ae,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),ae.forEach(i),Y=U($),A=k($,"DIV",{class:!0});var se=E(A);B=k(se,"INPUT",{type:!0}),se.forEach(i),$.forEach(i),re.forEach(i),K.forEach(i),te.forEach(i),m.forEach(i),this.h()},h(){c(e,"class","status"),c(a,"class","game-board"),c(r,"class","column"),c(b,"class","chat-messages"),c(P,"type","text"),c(P,"id","chat-msg"),c(P,"name","msg"),c(P,"placeholder","Message"),c(L,"class","column"),c(B,"type","submit"),B.value="Send",B.disabled=S=!n[3]||!n[7],c(A,"class","column"),c(I,"class","row"),c(o,"id","chat"),c(_,"class","column"),c(l,"class","row")},m(s,O){V(s,e,O),y.m(e,null),V(s,t,O),V(s,l,O),u(l,r),u(r,a);for(let m=0;m<T.length;m+=1)T[m]&&T[m].m(a,null);u(l,d),u(l,_),u(_,o),u(o,h),u(h,f),u(o,p),u(o,b);for(let m=0;m<N.length;m+=1)N[m]&&N[m].m(b,null);u(o,J),u(o,j),u(j,I),u(I,L),u(L,P),Q(P,n[0]),u(I,Y),u(I,A),u(A,B),F||(D=[H(P,"input",n[16]),H(j,"submit",ve(n[10]))],F=!0)},p(s,O){if(v===(v=w(s))&&y?y.p(s,O):(y.d(1),y=v(s),y&&(y.c(),y.m(e,null))),O&2160){q=s[6].board;let m;for(m=0;m<q.length;m+=1){const z=ue(s,q,m);T[m]?T[m].p(z,O):(T[m]=fe(z),T[m].c(),T[m].m(a,null))}for(;m<T.length;m+=1)T[m].d(1);T.length=q.length}if(O&64){R=s[6].chat;let m;for(m=0;m<R.length;m+=1){const z=ie(s,R,m);N[m]?N[m].p(z,O):(N[m]=de(z),N[m].c(),N[m].m(b,null))}for(;m<N.length;m+=1)N[m].d(1);N.length=R.length}O&1&&P.value!==s[0]&&Q(P,s[0]),O&136&&S!==(S=!s[3]||!s[7])&&(B.disabled=S)},d(s){s&&i(e),y.d(),s&&i(t),s&&i(l),oe(T,s),oe(N,s),F=!1,be(D)}}}function Ne(n){let e;return{c(){e=G("Opponent's turn")},l(t){e=C(t,"Opponent's turn")},m(t,l){V(t,e,l)},p:W,d(t){t&&i(e)}}}function Ve(n){let e;return{c(){e=G("Your turn")},l(t){e=C(t,"Your turn")},m(t,l){V(t,e,l)},p:W,d(t){t&&i(e)}}}function Pe(n){let e;function t(a,d){return a[6].winner==="Draw"?Ce:a[6].winner.Win===a[5]?Ge:Oe}let l=t(n),r=l(n);return{c(){r.c(),e=x()},l(a){r.l(a),e=x()},m(a,d){r.m(a,d),V(a,e,d)},p(a,d){l!==(l=t(a))&&(r.d(1),r=l(a),r&&(r.c(),r.m(e.parentNode,e)))},d(a){r.d(a),a&&i(e)}}}function Se(n){let e;return{c(){e=G("Waiting for opponent...")},l(t){e=C(t,"Waiting for opponent...")},m(t,l){V(t,e,l)},p:W,d(t){t&&i(e)}}}function Oe(n){let e;return{c(){e=G("You lost!")},l(t){e=C(t,"You lost!")},m(t,l){V(t,e,l)},d(t){t&&i(e)}}}function Ge(n){let e;return{c(){e=G("You won!")},l(t){e=C(t,"You won!")},m(t,l){V(t,e,l)},d(t){t&&i(e)}}}function Ce(n){let e;return{c(){e=G("Draw!")},l(t){e=C(t,"Draw!")},m(t,l){V(t,e,l)},d(t){t&&i(e)}}}function fe(n){let e,t=n[23]+"",l,r,a,d,_,o;function h(){return n[15](n[25])}return{c(){e=g("button"),l=G(t),r=M(),this.h()},l(f){e=k(f,"BUTTON",{type:!0,class:!0});var p=E(e);l=C(p,t),r=U(p),p.forEach(i),this.h()},h(){c(e,"type","button"),c(e,"class",a="game-square "+n[23]),e.disabled=d=!n[4]||n[6].turn!==n[5]||n[23]!==" "},m(f,p){V(f,e,p),u(e,l),u(e,r),_||(o=H(e,"click",h),_=!0)},p(f,p){n=f,p&64&&t!==(t=n[23]+"")&&Z(l,t),p&64&&a!==(a="game-square "+n[23])&&c(e,"class",a),p&112&&d!==(d=!n[4]||n[6].turn!==n[5]||n[23]!==" ")&&(e.disabled=d)},d(f){f&&i(e),_=!1,o()}}}function Je(n){var o;let e,t=((o=_e(n[6],n[19].Player))==null?void 0:o.name)+"",l,r,a=n[19].Player+"",d,_;return{c(){e=g("span"),l=G(t),r=G(" ("),d=G(a),_=G("):"),this.h()},l(h){e=k(h,"SPAN",{class:!0});var f=E(e);l=C(f,t),r=C(f," ("),d=C(f,a),_=C(f,"):"),f.forEach(i),this.h()},h(){c(e,"class","chat-message-player")},m(h,f){V(h,e,f),u(e,l),u(e,r),u(e,d),u(e,_)},p(h,f){var p;f&64&&t!==(t=((p=_e(h[6],h[19].Player))==null?void 0:p.name)+"")&&Z(l,t),f&64&&a!==(a=h[19].Player+"")&&Z(d,a)},d(h){h&&i(e)}}}function Me(n){let e,t;return{c(){e=g("span"),t=G("Server:"),this.h()},l(l){e=k(l,"SPAN",{class:!0});var r=E(e);t=C(r,"Server:"),r.forEach(i),this.h()},h(){c(e,"class","chat-message-server")},m(l,r){V(l,e,r),u(e,t)},p:W,d(l){l&&i(e)}}}function de(n){let e,t,l,r=n[20]+"",a,d,_;function o(p,b){return p[19]==="System"?Me:Je}let h=o(n),f=h(n);return{c(){e=g("div"),f.c(),t=M(),l=g("span"),a=G(r),d=M(),this.h()},l(p){e=k(p,"DIV",{class:!0,id:!0});var b=E(e);f.l(b),t=U(b),l=k(b,"SPAN",{class:!0});var J=E(l);a=C(J,r),J.forEach(i),d=U(b),b.forEach(i),this.h()},h(){c(l,"class","chat-message-text"),c(e,"class","chat-message"),c(e,"id",_=`chat-message-${n[18]}`)},m(p,b){V(p,e,b),f.m(e,null),u(e,t),u(e,l),u(l,a),u(e,d)},p(p,b){h===(h=o(p))&&f?f.p(p,b):(f.d(1),f=h(p),f&&(f.c(),f.m(e,t))),b&64&&r!==(r=p[20]+"")&&Z(a,r),b&64&&_!==(_=`chat-message-${p[18]}`)&&c(e,"id",_)},d(p){p&&i(e),f.d()}}}function Ue(n){let e,t,l,r,a,d,_,o,h,f,p,b=n[3]?"Code For Others to Join You":"Game Token",J,j,I,L,P,Y,A,B;function S(v,y){return v[3]?De:Te}let F=S(n),D=F(n),w=n[3]&&ce(n);return{c(){e=g("div"),t=g("form"),l=g("div"),r=g("div"),a=g("label"),d=G("Player Name"),_=M(),o=g("input"),h=M(),f=g("div"),p=g("label"),J=G(b),j=M(),I=g("input"),L=M(),D.c(),P=M(),w&&w.c(),Y=x(),this.h()},l(v){e=k(v,"DIV",{id:!0});var y=E(e);t=k(y,"FORM",{id:!0});var q=E(t);l=k(q,"DIV",{class:!0});var T=E(l);r=k(T,"DIV",{class:!0});var R=E(r);a=k(R,"LABEL",{for:!0});var N=E(a);d=C(N,"Player Name"),N.forEach(i),_=U(R),o=k(R,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),R.forEach(i),h=U(T),f=k(T,"DIV",{class:!0});var s=E(f);p=k(s,"LABEL",{for:!0});var O=E(p);J=C(O,b),O.forEach(i),j=U(s),I=k(s,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),s.forEach(i),L=U(T),D.l(T),T.forEach(i),q.forEach(i),y.forEach(i),P=U(v),w&&w.l(v),Y=x(),this.h()},h(){c(a,"for","player-name"),c(o,"type","text"),c(o,"id","player-name"),c(o,"name","name"),c(o,"placeholder","Player Name"),o.readOnly=n[3],c(r,"class","column"),c(p,"for","join-token"),c(I,"type","text"),c(I,"id","join-token"),c(I,"name","token"),c(I,"placeholder","Join Token (Leave blank for new game)"),I.readOnly=n[3],c(f,"class","column"),c(l,"class","row"),c(t,"id","join-game-form"),c(e,"id","menu")},m(v,y){V(v,e,y),u(e,t),u(t,l),u(l,r),u(r,a),u(a,d),u(r,_),u(r,o),Q(o,n[2]),u(l,h),u(l,f),u(f,p),u(p,J),u(f,j),u(f,I),Q(I,n[1]),u(l,L),D.m(l,null),V(v,P,y),w&&w.m(v,y),V(v,Y,y),A||(B=[H(o,"input",n[12]),H(I,"click",n[13]),H(I,"input",n[14]),H(t,"submit",ve(n[8]))],A=!0)},p(v,[y]){y&8&&(o.readOnly=v[3]),y&4&&o.value!==v[2]&&Q(o,v[2]),y&8&&b!==(b=v[3]?"Code For Others to Join You":"Game Token")&&Z(J,b),y&8&&(I.readOnly=v[3]),y&2&&I.value!==v[1]&&Q(I,v[1]),F===(F=S(v))&&D?D.p(v,y):(D.d(1),D=F(v),D&&(D.c(),D.m(l,null))),v[3]?w?w.p(v,y):(w=ce(v),w.c(),w.m(Y.parentNode,Y)):w&&(w.d(1),w=null)},i:W,o:W,d(v){v&&i(e),D.d(),v&&i(P),w&&w.d(v),v&&i(Y),A=!1,be(B)}}}function _e(n,e){return n.players.find(t=>t.team===e)}function je(n,e,t){let l="",r="",a=!1,d=!1,_="X",o={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},h=null;function f(){a||(console.log("Joining game with player name:",r,"and join token:",l),h=new WebSocket("ws://localhost:3000/ws?token="+encodeURIComponent(l)+"&name="+encodeURIComponent(r)),h.onopen=()=>{t(0,b=""),t(3,a=!0)},h.onmessage=S=>{console.debug("Got Msg From Server:",S);const F=JSON.parse(S.data);console.debug("json",F);const D=Object.keys(F)[0].toString(),w=F[D];if(D==="JoinedGame"){const{token:v,team:y,state:q}=w;t(1,l=v),t(6,o=q),t(5,_=y),t(4,d=o.players.length===2)}else D==="GameState"?(t(6,o=w),t(4,d=o.players.length===2)):D==="Error"?(console.error("Error from server",w),window.alert(w)):console.error("Unknown message type",D)},h.onclose=()=>{t(3,a=!1),t(1,l=""),console.log("disconnected by server")},h.onerror=S=>{console.error("error",S)})}function p(){console.log("Leaving game"),h&&h.close()}let b="",J=!1;function j(){h&&J&&(h.send(JSON.stringify({ChatMsg:{text:b}})),t(0,b=""))}function I(S){if(h){if(!d){console.warn("not enough players to play");return}h.send(JSON.stringify({Move:{space:S}}))}}function L(){r=this.value,t(2,r)}const P=S=>{a&&(S.currentTarget.select(),navigator.clipboard.writeText(l))};function Y(){l=this.value,t(1,l)}const A=S=>I(S);function B(){b=this.value,t(0,b)}return n.$$.update=()=>{n.$$.dirty&1&&t(7,J=(b||"").replace(/^\s+|\s+$/gm,"").length>0)},[b,l,r,a,d,_,o,J,f,p,j,I,L,P,Y,A,B]}class Le extends he{constructor(e){super(),me(this,e,je,Ue,pe,{})}}function Ye(n){let e,t,l,r,a,d;return a=new Le({}),{c(){e=g("div"),t=g("h1"),l=G("Tic Tac Toe"),r=M(),ge(a.$$.fragment),this.h()},l(_){e=k(_,"DIV",{class:!0});var o=E(e);t=k(o,"H1",{});var h=E(t);l=C(h,"Tic Tac Toe"),h.forEach(i),r=U(o),ke(a.$$.fragment,o),o.forEach(i),this.h()},h(){c(e,"class","container")},m(_,o){V(_,e,o),u(e,t),u(t,l),u(e,r),ye(a,e,null),d=!0},p:W,i(_){d||(Ee(a.$$.fragment,_),d=!0)},o(_){Ie(a.$$.fragment,_),d=!1},d(_){_&&i(e),we(a)}}}class Be extends he{constructor(e){super(),me(this,e,null,Ye,pe,{})}}export{Be as default};
