import{S as _e,i as me,s as pe,k as v,q as O,a as J,e as x,l as b,m as E,r as M,h as c,c as j,n as d,b as G,G as s,J as Q,K as H,L as ve,u as Z,H as q,M as be,o as ge,N as se,y as ke,z as ye,A as Ee,g as we,d as Pe,B as Ie}from"../chunks/index.259c4853.js";function ie(r,e,t){const l=r.slice();return l[20]=e[t].id,l[21]=e[t].source,l[22]=e[t].text,l}function ue(r,e,t){const l=r.slice();return l[25]=e[t],l[27]=t,l}function Te(r){let e,t;return{c(){e=v("div"),t=v("input"),this.h()},l(l){e=b(l,"DIV",{class:!0});var o=E(e);t=b(o,"INPUT",{type:!0,class:!0}),o.forEach(c),this.h()},h(){d(t,"type","submit"),t.value="Join Game",d(t,"class","horizontal-submit"),d(e,"class","column")},m(l,o){G(l,e,o),s(e,t)},p:q,d(l){l&&c(e)}}}function De(r){let e,t,l,o,n;return{c(){e=v("div"),t=v("button"),l=O("Leave Game"),this.h()},l(h){e=b(h,"DIV",{class:!0});var _=E(e);t=b(_,"BUTTON",{type:!0,class:!0});var f=E(t);l=M(f,"Leave Game"),f.forEach(c),_.forEach(c),this.h()},h(){d(t,"type","button"),d(t,"class","horizontal-submit"),d(e,"class","column")},m(h,_){G(h,e,_),s(e,t),s(t,l),o||(n=H(t,"click",r[9]),o=!0)},p:q,d(h){h&&c(e),o=!1,n()}}}function ce(r){let e,t,l,o,n,h,_,f,y,a,i,g,N,P,w,U,S,L,F,W,R,B,T;function D(u,C){return u[4]?u[6].winner?Ve:u[6].turn===u[5]?Se:Ne:Oe}let p=D(r),k=p(r),Y=r[6].board,I=[];for(let u=0;u<Y.length;u+=1)I[u]=fe(ue(r,Y,u));let A=r[6].chat,V=[];for(let u=0;u<A.length;u+=1)V[u]=de(ie(r,A,u));return{c(){e=v("div"),k.c(),t=J(),l=v("div"),o=v("div"),n=v("div");for(let u=0;u<I.length;u+=1)I[u].c();h=J(),_=v("div"),f=v("div"),y=v("h2"),a=O("Chat"),i=J(),g=v("div");for(let u=0;u<V.length;u+=1)V[u].c();N=J(),P=v("form"),w=v("div"),U=v("div"),S=v("input"),L=J(),F=v("div"),W=v("input"),this.h()},l(u){e=b(u,"DIV",{class:!0});var C=E(e);k.l(C),C.forEach(c),t=j(u),l=b(u,"DIV",{class:!0});var m=E(l);o=b(m,"DIV",{class:!0});var z=E(o);n=b(z,"DIV",{class:!0});var ee=E(n);for(let X=0;X<I.length;X+=1)I[X].l(ee);ee.forEach(c),z.forEach(c),h=j(m),_=b(m,"DIV",{class:!0});var te=E(_);f=b(te,"DIV",{id:!0});var K=E(f);y=b(K,"H2",{});var le=E(y);a=M(le,"Chat"),le.forEach(c),i=j(K),g=b(K,"DIV",{class:!0});var re=E(g);for(let X=0;X<V.length;X+=1)V[X].l(re);re.forEach(c),N=j(K),P=b(K,"FORM",{});var ne=E(P);w=b(ne,"DIV",{class:!0});var $=E(w);U=b($,"DIV",{class:!0});var oe=E(U);S=b(oe,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),oe.forEach(c),L=j($),F=b($,"DIV",{class:!0});var ae=E(F);W=b(ae,"INPUT",{type:!0}),ae.forEach(c),$.forEach(c),ne.forEach(c),K.forEach(c),te.forEach(c),m.forEach(c),this.h()},h(){d(e,"class","status"),d(n,"class","game-board"),d(o,"class","column"),d(g,"class","chat-messages"),d(S,"type","text"),d(S,"id","chat-msg"),d(S,"name","msg"),d(S,"placeholder","Message"),d(U,"class","column"),d(W,"type","submit"),W.value="Send",W.disabled=R=!r[3]||!r[7],d(F,"class","column"),d(w,"class","row"),d(f,"id","chat"),d(_,"class","column"),d(l,"class","row")},m(u,C){G(u,e,C),k.m(e,null),G(u,t,C),G(u,l,C),s(l,o),s(o,n);for(let m=0;m<I.length;m+=1)I[m]&&I[m].m(n,null);s(l,h),s(l,_),s(_,f),s(f,y),s(y,a),s(f,i),s(f,g);for(let m=0;m<V.length;m+=1)V[m]&&V[m].m(g,null);s(f,N),s(f,P),s(P,w),s(w,U),s(U,S),Q(S,r[0]),s(w,L),s(w,F),s(F,W),B||(T=[H(S,"input",r[16]),H(P,"submit",ve(r[10]))],B=!0)},p(u,C){if(p===(p=D(u))&&k?k.p(u,C):(k.d(1),k=p(u),k&&(k.c(),k.m(e,null))),C&2160){Y=u[6].board;let m;for(m=0;m<Y.length;m+=1){const z=ue(u,Y,m);I[m]?I[m].p(z,C):(I[m]=fe(z),I[m].c(),I[m].m(n,null))}for(;m<I.length;m+=1)I[m].d(1);I.length=Y.length}if(C&64){A=u[6].chat;let m;for(m=0;m<A.length;m+=1){const z=ie(u,A,m);V[m]?V[m].p(z,C):(V[m]=de(z),V[m].c(),V[m].m(g,null))}for(;m<V.length;m+=1)V[m].d(1);V.length=A.length}C&1&&S.value!==u[0]&&Q(S,u[0]),C&136&&R!==(R=!u[3]||!u[7])&&(W.disabled=R)},d(u){u&&c(e),k.d(),u&&c(t),u&&c(l),se(I,u),se(V,u),B=!1,be(T)}}}function Ne(r){let e;return{c(){e=O("Opponent's turn")},l(t){e=M(t,"Opponent's turn")},m(t,l){G(t,e,l)},p:q,d(t){t&&c(e)}}}function Se(r){let e;return{c(){e=O("Your turn")},l(t){e=M(t,"Your turn")},m(t,l){G(t,e,l)},p:q,d(t){t&&c(e)}}}function Ve(r){let e;function t(n,h){return n[6].winner==="Draw"?Ce:n[6].winner.Win===n[5]?Ge:Me}let l=t(r),o=l(r);return{c(){o.c(),e=x()},l(n){o.l(n),e=x()},m(n,h){o.m(n,h),G(n,e,h)},p(n,h){l!==(l=t(n))&&(o.d(1),o=l(n),o&&(o.c(),o.m(e.parentNode,e)))},d(n){o.d(n),n&&c(e)}}}function Oe(r){let e;return{c(){e=O("Waiting for opponent...")},l(t){e=M(t,"Waiting for opponent...")},m(t,l){G(t,e,l)},p:q,d(t){t&&c(e)}}}function Me(r){let e;return{c(){e=O("You lost!")},l(t){e=M(t,"You lost!")},m(t,l){G(t,e,l)},d(t){t&&c(e)}}}function Ge(r){let e;return{c(){e=O("You won!")},l(t){e=M(t,"You won!")},m(t,l){G(t,e,l)},d(t){t&&c(e)}}}function Ce(r){let e;return{c(){e=O("Draw!")},l(t){e=M(t,"Draw!")},m(t,l){G(t,e,l)},d(t){t&&c(e)}}}function fe(r){let e,t=r[25]+"",l,o,n,h,_,f;function y(){return r[15](r[27])}return{c(){e=v("button"),l=O(t),o=J(),this.h()},l(a){e=b(a,"BUTTON",{type:!0,class:!0});var i=E(e);l=M(i,t),o=j(i),i.forEach(c),this.h()},h(){d(e,"type","button"),d(e,"class",n="game-square "+r[25]),e.disabled=h=!r[4]||r[6].turn!==r[5]||r[25]!==" "},m(a,i){G(a,e,i),s(e,l),s(e,o),_||(f=H(e,"click",y),_=!0)},p(a,i){r=a,i&64&&t!==(t=r[25]+"")&&Z(l,t),i&64&&n!==(n="game-square "+r[25])&&d(e,"class",n),i&112&&h!==(h=!r[4]||r[6].turn!==r[5]||r[25]!==" ")&&(e.disabled=h)},d(a){a&&c(e),_=!1,f()}}}function Ue(r){var f;let e,t=((f=he(r[6],r[21].Player))==null?void 0:f.name)+"",l,o,n=r[21].Player+"",h,_;return{c(){e=v("span"),l=O(t),o=O(" ("),h=O(n),_=O("):"),this.h()},l(y){e=b(y,"SPAN",{class:!0});var a=E(e);l=M(a,t),o=M(a," ("),h=M(a,n),_=M(a,"):"),a.forEach(c),this.h()},h(){d(e,"class","chat-message-player")},m(y,a){G(y,e,a),s(e,l),s(e,o),s(e,h),s(e,_)},p(y,a){var i;a&64&&t!==(t=((i=he(y[6],y[21].Player))==null?void 0:i.name)+"")&&Z(l,t),a&64&&n!==(n=y[21].Player+"")&&Z(h,n)},d(y){y&&c(e)}}}function Le(r){let e,t;return{c(){e=v("span"),t=O("Server:"),this.h()},l(l){e=b(l,"SPAN",{class:!0});var o=E(e);t=M(o,"Server:"),o.forEach(c),this.h()},h(){d(e,"class","chat-message-server")},m(l,o){G(l,e,o),s(e,t)},p:q,d(l){l&&c(e)}}}function de(r){let e,t,l,o=r[22]+"",n,h,_;function f(i,g){return i[21]==="System"?Le:Ue}let y=f(r),a=y(r);return{c(){e=v("div"),a.c(),t=J(),l=v("span"),n=O(o),h=J(),this.h()},l(i){e=b(i,"DIV",{class:!0,id:!0});var g=E(e);a.l(g),t=j(g),l=b(g,"SPAN",{class:!0});var N=E(l);n=M(N,o),N.forEach(c),h=j(g),g.forEach(c),this.h()},h(){d(l,"class","chat-message-text"),d(e,"class","chat-message"),d(e,"id",_=`chat-message-${r[20]}`)},m(i,g){G(i,e,g),a.m(e,null),s(e,t),s(e,l),s(l,n),s(e,h)},p(i,g){y===(y=f(i))&&a?a.p(i,g):(a.d(1),a=y(i),a&&(a.c(),a.m(e,t))),g&64&&o!==(o=i[22]+"")&&Z(n,o),g&64&&_!==(_=`chat-message-${i[20]}`)&&d(e,"id",_)},d(i){i&&c(e),a.d()}}}function Je(r){let e,t,l,o,n,h,_,f,y,a,i,g=r[3]?"Code For Others to Join You":"Game Token",N,P,w,U,S,L,F,W;function R(p,k){return p[3]?De:Te}let B=R(r),T=B(r),D=r[3]&&ce(r);return{c(){e=v("div"),t=v("form"),l=v("div"),o=v("div"),n=v("label"),h=O("Player Name"),_=J(),f=v("input"),y=J(),a=v("div"),i=v("label"),N=O(g),P=J(),w=v("input"),U=J(),T.c(),S=J(),D&&D.c(),L=x(),this.h()},l(p){e=b(p,"DIV",{id:!0});var k=E(e);t=b(k,"FORM",{id:!0});var Y=E(t);l=b(Y,"DIV",{class:!0});var I=E(l);o=b(I,"DIV",{class:!0});var A=E(o);n=b(A,"LABEL",{for:!0});var V=E(n);h=M(V,"Player Name"),V.forEach(c),_=j(A),f=b(A,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),A.forEach(c),y=j(I),a=b(I,"DIV",{class:!0});var u=E(a);i=b(u,"LABEL",{for:!0});var C=E(i);N=M(C,g),C.forEach(c),P=j(u),w=b(u,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),u.forEach(c),U=j(I),T.l(I),I.forEach(c),Y.forEach(c),k.forEach(c),S=j(p),D&&D.l(p),L=x(),this.h()},h(){d(n,"for","player-name"),d(f,"type","text"),d(f,"id","player-name"),d(f,"name","name"),d(f,"placeholder","Player Name"),f.readOnly=r[3],d(o,"class","column"),d(i,"for","join-token"),d(w,"type","text"),d(w,"id","join-token"),d(w,"name","token"),d(w,"placeholder","Join Token (Leave blank for new game)"),w.readOnly=r[3],d(a,"class","column"),d(l,"class","row"),d(t,"id","join-game-form"),d(e,"id","menu")},m(p,k){G(p,e,k),s(e,t),s(t,l),s(l,o),s(o,n),s(n,h),s(o,_),s(o,f),Q(f,r[2]),s(l,y),s(l,a),s(a,i),s(i,N),s(a,P),s(a,w),Q(w,r[1]),s(l,U),T.m(l,null),G(p,S,k),D&&D.m(p,k),G(p,L,k),F||(W=[H(f,"input",r[12]),H(w,"click",r[13]),H(w,"input",r[14]),H(t,"submit",ve(r[8]))],F=!0)},p(p,[k]){k&8&&(f.readOnly=p[3]),k&4&&f.value!==p[2]&&Q(f,p[2]),k&8&&g!==(g=p[3]?"Code For Others to Join You":"Game Token")&&Z(N,g),k&8&&(w.readOnly=p[3]),k&2&&w.value!==p[1]&&Q(w,p[1]),B===(B=R(p))&&T?T.p(p,k):(T.d(1),T=B(p),T&&(T.c(),T.m(l,null))),p[3]?D?D.p(p,k):(D=ce(p),D.c(),D.m(L.parentNode,L)):D&&(D.d(1),D=null)},i:q,o:q,d(p){p&&c(e),T.d(),p&&c(S),D&&D.d(p),p&&c(L),F=!1,be(W)}}}function he(r,e){return r.players.find(t=>t.team===e)}function je(r,e,t){let l=null,o="",n="";ge(()=>{l=new URL(window.location.href),o=`${l.protocol==="https:"?"wss://":"ws://"}${l.host}/ws`,t(1,n=l.searchParams.get("token")||""),n&&(t(2,h=l.searchParams.get("name")||""),g())});let h="",_=!1,f=!1,y="X",a={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},i=null;function g(){if(_)return;if(!o)throw new Error("socketUrl not set");console.log("Joining game with player name:",h,"and join token:",n);const T=new URL(o);T.searchParams.set("token",n),T.searchParams.set("name",h),i=new WebSocket(T.href),i.onopen=()=>{t(0,P=""),t(3,_=!0)},i.onmessage=D=>{console.debug("Got Msg From Server:",D);const p=JSON.parse(D.data);console.debug("json",p);const k=Object.keys(p)[0].toString(),Y=p[k];if(k==="JoinedGame"){const{token:I,team:A,state:V}=Y;t(1,n=I),t(6,a=V),t(5,y=A),t(4,f=a.players.length===2)}else k==="GameState"?(t(6,a=Y),t(4,f=a.players.length===2)):k==="Error"?(console.error("Error from server",Y),window.alert(Y)):console.error("Unknown message type",k)},i.onclose=()=>{t(3,_=!1),t(1,n=""),console.log("disconnected by server")},i.onerror=D=>{console.error("error",D)}}function N(){console.log("Leaving game"),i&&i.close()}let P="",w=!1;function U(){i&&w&&(i.send(JSON.stringify({ChatMsg:{text:P}})),t(0,P=""))}function S(T){if(i){if(!f){console.warn("not enough players to play");return}i.send(JSON.stringify({Move:{space:T}}))}}function L(){h=this.value,t(2,h)}const F=T=>{_&&(T.currentTarget.select(),navigator.clipboard.writeText(n))};function W(){n=this.value,t(1,n)}const R=T=>S(T);function B(){P=this.value,t(0,P)}return r.$$.update=()=>{r.$$.dirty&1&&t(7,w=(P||"").replace(/^\s+|\s+$/gm,"").length>0)},[P,n,h,_,f,y,a,w,g,N,U,S,L,F,W,R,B]}class Ye extends _e{constructor(e){super(),me(this,e,je,Je,pe,{})}}function Ae(r){let e,t,l,o,n,h,_,f,y,a,i,g;return n=new Ye({}),{c(){e=v("div"),t=v("h1"),l=O("Tic Tac Toe"),o=J(),ke(n.$$.fragment),h=J(),_=v("footer"),f=v("p"),y=O(`Copyright © 2023 William Manahan-Makley |
            `),a=v("a"),i=O("Source Code"),this.h()},l(N){e=b(N,"DIV",{class:!0});var P=E(e);t=b(P,"H1",{});var w=E(t);l=M(w,"Tic Tac Toe"),w.forEach(c),o=j(P),ye(n.$$.fragment,P),h=j(P),_=b(P,"FOOTER",{});var U=E(_);f=b(U,"P",{});var S=E(f);y=M(S,`Copyright © 2023 William Manahan-Makley |
            `),a=b(S,"A",{href:!0});var L=E(a);i=M(L,"Source Code"),L.forEach(c),S.forEach(c),U.forEach(c),P.forEach(c),this.h()},h(){d(a,"href","https://github.com/wmakley/tictactoe-rs"),d(e,"class","container")},m(N,P){G(N,e,P),s(e,t),s(t,l),s(e,o),Ee(n,e,null),s(e,h),s(e,_),s(_,f),s(f,y),s(f,a),s(a,i),g=!0},p:q,i(N){g||(we(n.$$.fragment,N),g=!0)},o(N){Pe(n.$$.fragment,N),g=!1},d(N){N&&c(e),Ie(n)}}}class We extends _e{constructor(e){super(),me(this,e,null,Ae,pe,{})}}export{We as default};
