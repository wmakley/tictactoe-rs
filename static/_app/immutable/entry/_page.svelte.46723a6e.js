import{S as he,i as me,s as pe,k as b,q as G,a as J,e as x,l as g,m as y,r as L,h as i,c as j,n as f,b as N,G as c,J as Q,K as z,L as ve,u as Z,H,M as be,N as ae,y as ge,z as ke,A as ye,g as Ee,d as we,B as Ie,o as Te}from"../chunks/index.259c4853.js";function ie(n,e,t){const l=n.slice();return l[19]=e[t].id,l[20]=e[t].source,l[21]=e[t].text,l}function ue(n,e,t){const l=n.slice();return l[24]=e[t],l[26]=t,l}function De(n){let e,t;return{c(){e=b("div"),t=b("input"),this.h()},l(l){e=g(l,"DIV",{class:!0});var r=y(e);t=g(r,"INPUT",{type:!0,class:!0}),r.forEach(i),this.h()},h(){f(t,"type","submit"),t.value="Join Game",f(t,"class","horizontal-submit"),f(e,"class","column")},m(l,r){N(l,e,r),c(e,t)},p:H,d(l){l&&i(e)}}}function Pe(n){let e,t,l,r,s;return{c(){e=b("div"),t=b("button"),l=G("Leave Game"),this.h()},l(d){e=g(d,"DIV",{class:!0});var _=y(e);t=g(_,"BUTTON",{type:!0,class:!0});var u=y(t);l=L(u,"Leave Game"),u.forEach(i),_.forEach(i),this.h()},h(){f(t,"type","button"),f(t,"class","horizontal-submit"),f(e,"class","column")},m(d,_){N(d,e,_),c(e,t),c(t,l),r||(s=z(t,"click",n[9]),r=!0)},p:H,d(d){d&&i(e),r=!1,s()}}}function ce(n){let e,t,l,r,s,d,_,u,v,o,p,E,V,M,I,C,S,A,B,F,R,D,U;function T(a,O){return a[4]?a[6].winner?Ue:a[6].turn===a[5]?Ve:Ne:Se}let h=T(n),k=h(n),q=n[6].board,w=[];for(let a=0;a<q.length;a+=1)w[a]=fe(ue(n,q,a));let Y=n[6].chat,P=[];for(let a=0;a<Y.length;a+=1)P[a]=de(ie(n,Y,a));return{c(){e=b("div"),k.c(),t=J(),l=b("div"),r=b("div"),s=b("div");for(let a=0;a<w.length;a+=1)w[a].c();d=J(),_=b("div"),u=b("div"),v=b("h2"),o=G("Chat"),p=J(),E=b("div");for(let a=0;a<P.length;a+=1)P[a].c();V=J(),M=b("form"),I=b("div"),C=b("div"),S=b("input"),A=J(),B=b("div"),F=b("input"),this.h()},l(a){e=g(a,"DIV",{class:!0});var O=y(e);k.l(O),O.forEach(i),t=j(a),l=g(a,"DIV",{class:!0});var m=y(l);r=g(m,"DIV",{class:!0});var W=y(r);s=g(W,"DIV",{class:!0});var ee=y(s);for(let X=0;X<w.length;X+=1)w[X].l(ee);ee.forEach(i),W.forEach(i),d=j(m),_=g(m,"DIV",{class:!0});var te=y(_);u=g(te,"DIV",{id:!0});var K=y(u);v=g(K,"H2",{});var le=y(v);o=L(le,"Chat"),le.forEach(i),p=j(K),E=g(K,"DIV",{class:!0});var ne=y(E);for(let X=0;X<P.length;X+=1)P[X].l(ne);ne.forEach(i),V=j(K),M=g(K,"FORM",{});var re=y(M);I=g(re,"DIV",{class:!0});var $=y(I);C=g($,"DIV",{class:!0});var se=y(C);S=g(se,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),se.forEach(i),A=j($),B=g($,"DIV",{class:!0});var oe=y(B);F=g(oe,"INPUT",{type:!0}),oe.forEach(i),$.forEach(i),re.forEach(i),K.forEach(i),te.forEach(i),m.forEach(i),this.h()},h(){f(e,"class","status"),f(s,"class","game-board"),f(r,"class","column"),f(E,"class","chat-messages"),f(S,"type","text"),f(S,"id","chat-msg"),f(S,"name","msg"),f(S,"placeholder","Message"),f(C,"class","column"),f(F,"type","submit"),F.value="Send",F.disabled=R=!n[3]||!n[7],f(B,"class","column"),f(I,"class","row"),f(u,"id","chat"),f(_,"class","column"),f(l,"class","row")},m(a,O){N(a,e,O),k.m(e,null),N(a,t,O),N(a,l,O),c(l,r),c(r,s);for(let m=0;m<w.length;m+=1)w[m]&&w[m].m(s,null);c(l,d),c(l,_),c(_,u),c(u,v),c(v,o),c(u,p),c(u,E);for(let m=0;m<P.length;m+=1)P[m]&&P[m].m(E,null);c(u,V),c(u,M),c(M,I),c(I,C),c(C,S),Q(S,n[0]),c(I,A),c(I,B),c(B,F),D||(U=[z(S,"input",n[17]),z(M,"submit",ve(n[10]))],D=!0)},p(a,O){if(h===(h=T(a))&&k?k.p(a,O):(k.d(1),k=h(a),k&&(k.c(),k.m(e,null))),O&2160){q=a[6].board;let m;for(m=0;m<q.length;m+=1){const W=ue(a,q,m);w[m]?w[m].p(W,O):(w[m]=fe(W),w[m].c(),w[m].m(s,null))}for(;m<w.length;m+=1)w[m].d(1);w.length=q.length}if(O&64){Y=a[6].chat;let m;for(m=0;m<Y.length;m+=1){const W=ie(a,Y,m);P[m]?P[m].p(W,O):(P[m]=de(W),P[m].c(),P[m].m(E,null))}for(;m<P.length;m+=1)P[m].d(1);P.length=Y.length}O&1&&S.value!==a[0]&&Q(S,a[0]),O&136&&R!==(R=!a[3]||!a[7])&&(F.disabled=R)},d(a){a&&i(e),k.d(),a&&i(t),a&&i(l),ae(w,a),ae(P,a),D=!1,be(U)}}}function Ne(n){let e;return{c(){e=G("Opponent's turn")},l(t){e=L(t,"Opponent's turn")},m(t,l){N(t,e,l)},p:H,d(t){t&&i(e)}}}function Ve(n){let e;return{c(){e=G("Your turn")},l(t){e=L(t,"Your turn")},m(t,l){N(t,e,l)},p:H,d(t){t&&i(e)}}}function Ue(n){let e;function t(s,d){return s[6].winner==="Draw"?Le:s[6].winner.Win===s[5]?Ge:Oe}let l=t(n),r=l(n);return{c(){r.c(),e=x()},l(s){r.l(s),e=x()},m(s,d){r.m(s,d),N(s,e,d)},p(s,d){l!==(l=t(s))&&(r.d(1),r=l(s),r&&(r.c(),r.m(e.parentNode,e)))},d(s){r.d(s),s&&i(e)}}}function Se(n){let e;return{c(){e=G("Waiting for opponent...")},l(t){e=L(t,"Waiting for opponent...")},m(t,l){N(t,e,l)},p:H,d(t){t&&i(e)}}}function Oe(n){let e;return{c(){e=G("You lost!")},l(t){e=L(t,"You lost!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function Ge(n){let e;return{c(){e=G("You won!")},l(t){e=L(t,"You won!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function Le(n){let e;return{c(){e=G("Draw!")},l(t){e=L(t,"Draw!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function fe(n){let e,t=n[24]+"",l,r,s,d,_,u;function v(){return n[16](n[26])}return{c(){e=b("button"),l=G(t),r=J(),this.h()},l(o){e=g(o,"BUTTON",{type:!0,class:!0});var p=y(e);l=L(p,t),r=j(p),p.forEach(i),this.h()},h(){f(e,"type","button"),f(e,"class",s="game-square "+n[24]),e.disabled=d=!n[4]||n[6].turn!==n[5]||n[24]!==" "},m(o,p){N(o,e,p),c(e,l),c(e,r),_||(u=z(e,"click",v),_=!0)},p(o,p){n=o,p&64&&t!==(t=n[24]+"")&&Z(l,t),p&64&&s!==(s="game-square "+n[24])&&f(e,"class",s),p&112&&d!==(d=!n[4]||n[6].turn!==n[5]||n[24]!==" ")&&(e.disabled=d)},d(o){o&&i(e),_=!1,u()}}}function Me(n){var u;let e,t=((u=_e(n[6],n[20].Player))==null?void 0:u.name)+"",l,r,s=n[20].Player+"",d,_;return{c(){e=b("span"),l=G(t),r=G(" ("),d=G(s),_=G("):"),this.h()},l(v){e=g(v,"SPAN",{class:!0});var o=y(e);l=L(o,t),r=L(o," ("),d=L(o,s),_=L(o,"):"),o.forEach(i),this.h()},h(){f(e,"class","chat-message-player")},m(v,o){N(v,e,o),c(e,l),c(e,r),c(e,d),c(e,_)},p(v,o){var p;o&64&&t!==(t=((p=_e(v[6],v[20].Player))==null?void 0:p.name)+"")&&Z(l,t),o&64&&s!==(s=v[20].Player+"")&&Z(d,s)},d(v){v&&i(e)}}}function Je(n){let e,t;return{c(){e=b("span"),t=G("Server:"),this.h()},l(l){e=g(l,"SPAN",{class:!0});var r=y(e);t=L(r,"Server:"),r.forEach(i),this.h()},h(){f(e,"class","chat-message-server")},m(l,r){N(l,e,r),c(e,t)},p:H,d(l){l&&i(e)}}}function de(n){let e,t,l,r=n[21]+"",s,d,_;function u(p,E){return p[20]==="System"?Je:Me}let v=u(n),o=v(n);return{c(){e=b("div"),o.c(),t=J(),l=b("span"),s=G(r),d=J(),this.h()},l(p){e=g(p,"DIV",{class:!0,id:!0});var E=y(e);o.l(E),t=j(E),l=g(E,"SPAN",{class:!0});var V=y(l);s=L(V,r),V.forEach(i),d=j(E),E.forEach(i),this.h()},h(){f(l,"class","chat-message-text"),f(e,"class","chat-message"),f(e,"id",_=`chat-message-${n[19]}`)},m(p,E){N(p,e,E),o.m(e,null),c(e,t),c(e,l),c(l,s),c(e,d)},p(p,E){v===(v=u(p))&&o?o.p(p,E):(o.d(1),o=v(p),o&&(o.c(),o.m(e,t))),E&64&&r!==(r=p[21]+"")&&Z(s,r),E&64&&_!==(_=`chat-message-${p[19]}`)&&f(e,"id",_)},d(p){p&&i(e),o.d()}}}function je(n){let e,t,l,r,s,d,_,u,v,o,p,E=n[3]?"Code For Others to Join You":"Game Token",V,M,I,C,S,A,B,F;function R(h,k){return h[3]?Pe:De}let D=R(n),U=D(n),T=n[3]&&ce(n);return{c(){e=b("div"),t=b("form"),l=b("div"),r=b("div"),s=b("label"),d=G("Player Name"),_=J(),u=b("input"),v=J(),o=b("div"),p=b("label"),V=G(E),M=J(),I=b("input"),C=J(),U.c(),S=J(),T&&T.c(),A=x(),this.h()},l(h){e=g(h,"DIV",{id:!0});var k=y(e);t=g(k,"FORM",{id:!0});var q=y(t);l=g(q,"DIV",{class:!0});var w=y(l);r=g(w,"DIV",{class:!0});var Y=y(r);s=g(Y,"LABEL",{for:!0});var P=y(s);d=L(P,"Player Name"),P.forEach(i),_=j(Y),u=g(Y,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),Y.forEach(i),v=j(w),o=g(w,"DIV",{class:!0});var a=y(o);p=g(a,"LABEL",{for:!0});var O=y(p);V=L(O,E),O.forEach(i),M=j(a),I=g(a,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),a.forEach(i),C=j(w),U.l(w),w.forEach(i),q.forEach(i),k.forEach(i),S=j(h),T&&T.l(h),A=x(),this.h()},h(){f(s,"for","player-name"),f(u,"type","text"),f(u,"id","player-name"),f(u,"name","name"),f(u,"placeholder","Player Name"),u.readOnly=n[3],f(r,"class","column"),f(p,"for","join-token"),f(I,"type","text"),f(I,"id","join-token"),f(I,"name","token"),f(I,"placeholder","Join Token (Leave blank for new game)"),I.readOnly=n[3],f(o,"class","column"),f(l,"class","row"),f(t,"id","join-game-form"),f(e,"id","menu")},m(h,k){N(h,e,k),c(e,t),c(t,l),c(l,r),c(r,s),c(s,d),c(r,_),c(r,u),Q(u,n[2]),c(l,v),c(l,o),c(o,p),c(p,V),c(o,M),c(o,I),Q(I,n[1]),c(l,C),U.m(l,null),N(h,S,k),T&&T.m(h,k),N(h,A,k),B||(F=[z(u,"input",n[13]),z(I,"click",n[14]),z(I,"input",n[15]),z(t,"submit",ve(n[8]))],B=!0)},p(h,[k]){k&8&&(u.readOnly=h[3]),k&4&&u.value!==h[2]&&Q(u,h[2]),k&8&&E!==(E=h[3]?"Code For Others to Join You":"Game Token")&&Z(V,E),k&8&&(I.readOnly=h[3]),k&2&&I.value!==h[1]&&Q(I,h[1]),D===(D=R(h))&&U?U.p(h,k):(U.d(1),U=D(h),U&&(U.c(),U.m(l,null))),h[3]?T?T.p(h,k):(T=ce(h),T.c(),T.m(A.parentNode,A)):T&&(T.d(1),T=null)},i:H,o:H,d(h){h&&i(e),U.d(),h&&i(S),T&&T.d(h),h&&i(A),B=!1,be(F)}}}function _e(n,e){return n.players.find(t=>t.team===e)}function Ce(n,e,t){let{socketUrl:l="ws://localhost:3000/ws"}=e,r="",s="",d=!1,_=!1,u="X",v={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},o=null;function p(){if(d)return;console.log("Joining game with player name:",s,"and join token:",r);const D=new URL(l);D.searchParams.set("token",r),D.searchParams.set("name",s),o=new WebSocket(D.href),o.onopen=()=>{t(0,V=""),t(3,d=!0)},o.onmessage=U=>{console.debug("Got Msg From Server:",U);const T=JSON.parse(U.data);console.debug("json",T);const h=Object.keys(T)[0].toString(),k=T[h];if(h==="JoinedGame"){const{token:q,team:w,state:Y}=k;t(1,r=q),t(6,v=Y),t(5,u=w),t(4,_=v.players.length===2)}else h==="GameState"?(t(6,v=k),t(4,_=v.players.length===2)):h==="Error"?(console.error("Error from server",k),window.alert(k)):console.error("Unknown message type",h)},o.onclose=()=>{t(3,d=!1),t(1,r=""),console.log("disconnected by server")},o.onerror=U=>{console.error("error",U)}}function E(){console.log("Leaving game"),o&&o.close()}let V="",M=!1;function I(){o&&M&&(o.send(JSON.stringify({ChatMsg:{text:V}})),t(0,V=""))}function C(D){if(o){if(!_){console.warn("not enough players to play");return}o.send(JSON.stringify({Move:{space:D}}))}}function S(){s=this.value,t(2,s)}const A=D=>{d&&(D.currentTarget.select(),navigator.clipboard.writeText(r))};function B(){r=this.value,t(1,r)}const F=D=>C(D);function R(){V=this.value,t(0,V)}return n.$$set=D=>{"socketUrl"in D&&t(12,l=D.socketUrl)},n.$$.update=()=>{n.$$.dirty&4096&&console.debug("socketUrl",l),n.$$.dirty&1&&t(7,M=(V||"").replace(/^\s+|\s+$/gm,"").length>0)},[V,r,s,d,_,u,v,M,p,E,I,C,l,S,A,B,F,R]}class Ye extends he{constructor(e){super(),me(this,e,Ce,je,pe,{socketUrl:12})}}function Ae(n){let e,t,l,r,s,d;return s=new Ye({props:{socketUrl:n[0]}}),{c(){e=b("div"),t=b("h1"),l=G("Tic Tac Toe"),r=J(),ge(s.$$.fragment),this.h()},l(_){e=g(_,"DIV",{class:!0});var u=y(e);t=g(u,"H1",{});var v=y(t);l=L(v,"Tic Tac Toe"),v.forEach(i),r=j(u),ke(s.$$.fragment,u),u.forEach(i),this.h()},h(){f(e,"class","container")},m(_,u){N(_,e,u),c(e,t),c(t,l),c(e,r),ye(s,e,null),d=!0},p(_,[u]){const v={};u&1&&(v.socketUrl=_[0]),s.$set(v)},i(_){d||(Ee(s.$$.fragment,_),d=!0)},o(_){we(s.$$.fragment,_),d=!1},d(_){_&&i(e),Ie(s)}}}function Be(n,e,t){let l="";Te(()=>t(1,l=window.location.href));let r="";return n.$$.update=()=>{if(n.$$.dirty&2&&l){const s=new URL(l),d=s.protocol==="https:"?"wss://":"ws://";t(0,r=`${d}${s.host}/ws`)}},[r,l]}class qe extends he{constructor(e){super(),me(this,e,Be,Ae,pe,{})}}export{qe as default};
