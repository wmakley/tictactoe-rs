import{S as be,i as ge,s as ke,k as p,q as V,a as L,e as te,l as v,m as g,r as U,h as i,c as j,n as h,b as C,G as s,J as x,K as X,L as ye,u as ee,H as z,M as we,o as Ee,N as ce,y as Ie,z as Ne,A as Pe,g as Se,d as Te,B as De}from"../chunks/index.259c4853.js";function fe(n,e,t){const l=n.slice();return l[20]=e[t].id,l[21]=e[t].source,l[22]=e[t].text,l}function de(n,e,t){const l=n.slice();return l[25]=e[t],l[27]=t,l}function Oe(n){let e,t,l;return{c(){e=p("div"),t=p("button"),l=V("Join or Start Game"),this.h()},l(o){e=v(o,"DIV",{class:!0});var r=g(e);t=v(r,"BUTTON",{type:!0,class:!0});var c=g(t);l=U(c,"Join or Start Game"),c.forEach(i),r.forEach(i),this.h()},h(){h(t,"type","submit"),h(t,"class","horizontal-submit"),h(e,"class","column")},m(o,r){C(o,e,r),s(e,t),s(t,l)},p:z,d(o){o&&i(e)}}}function Ve(n){let e,t,l,o,r;return{c(){e=p("div"),t=p("button"),l=V("Leave Game"),this.h()},l(c){e=v(c,"DIV",{class:!0});var m=g(e);t=v(m,"BUTTON",{type:!0,class:!0});var f=g(t);l=U(f,"Leave Game"),f.forEach(i),m.forEach(i),this.h()},h(){h(t,"type","button"),h(t,"class","horizontal-submit"),h(e,"class","column")},m(c,m){C(c,e,m),s(e,t),s(t,l),o||(r=X(t,"click",n[8]),o=!0)},p:z,d(c){c&&i(e),o=!1,r()}}}function he(n){let e,t,l,o,r,c,m,f,k,a,u,y,T,E,w,J,D,Y,B,F,H,q,N,P;function b(d,R){return d[3]?d[5].winner?Ge:d[5].turn===d[4]?Ce:Ue:Me}let I=b(n),G=I(n),A=n[5].board,S=[];for(let d=0;d<A.length;d+=1)S[d]=me(de(n,A,d));let W=n[5].chat,O=[];for(let d=0;d<W.length;d+=1)O[d]=_e(fe(n,W,d));let M=n[5].winner&&pe(n);return{c(){e=p("div"),G.c(),t=L(),l=p("div"),o=p("div"),r=p("div");for(let d=0;d<S.length;d+=1)S[d].c();c=L(),m=p("div"),f=p("div"),k=p("h2"),a=V("Chat"),u=L(),y=p("div");for(let d=0;d<O.length;d+=1)O[d].c();T=L(),E=p("form"),w=p("div"),J=p("div"),D=p("input"),Y=L(),B=p("div"),F=p("input"),q=L(),M&&M.c(),this.h()},l(d){e=v(d,"DIV",{class:!0});var R=g(e);G.l(R),R.forEach(i),t=j(d),l=v(d,"DIV",{class:!0});var _=g(l);o=v(_,"DIV",{class:!0});var K=g(o);r=v(K,"DIV",{class:!0});var ne=g(r);for(let Q=0;Q<S.length;Q+=1)S[Q].l(ne);ne.forEach(i),K.forEach(i),c=j(_),m=v(_,"DIV",{class:!0});var re=g(m);f=v(re,"DIV",{id:!0});var Z=g(f);k=v(Z,"H2",{});var oe=g(k);a=U(oe,"Chat"),oe.forEach(i),u=j(Z),y=v(Z,"DIV",{class:!0});var ae=g(y);for(let Q=0;Q<O.length;Q+=1)O[Q].l(ae);ae.forEach(i),T=j(Z),E=v(Z,"FORM",{});var se=g(E);w=v(se,"DIV",{class:!0});var $=g(w);J=v($,"DIV",{class:!0});var ie=g(J);D=v(ie,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),ie.forEach(i),Y=j($),B=v($,"DIV",{class:!0});var ue=g(B);F=v(ue,"INPUT",{type:!0}),ue.forEach(i),q=j($),M&&M.l($),$.forEach(i),se.forEach(i),Z.forEach(i),re.forEach(i),_.forEach(i),this.h()},h(){h(e,"class","status"),h(r,"class","game-board"),h(o,"class","column"),h(y,"class","chat-messages"),h(D,"type","text"),h(D,"id","chat-msg"),h(D,"name","msg"),h(D,"placeholder","Message"),h(J,"class","column"),h(F,"type","submit"),F.value="Send",F.disabled=H=!n[2]||!le(n[6]),h(B,"class","column"),h(w,"class","row"),h(f,"id","chat"),h(m,"class","column"),h(l,"class","row")},m(d,R){C(d,e,R),G.m(e,null),C(d,t,R),C(d,l,R),s(l,o),s(o,r);for(let _=0;_<S.length;_+=1)S[_]&&S[_].m(r,null);s(l,c),s(l,m),s(m,f),s(f,k),s(k,a),s(f,u),s(f,y);for(let _=0;_<O.length;_+=1)O[_]&&O[_].m(y,null);s(f,T),s(f,E),s(E,w),s(w,J),s(J,D),x(D,n[6]),s(w,Y),s(w,B),s(B,F),s(w,q),M&&M.m(w,null),N||(P=[X(D,"input",n[16]),X(E,"submit",ye(n[9]))],N=!0)},p(d,R){if(I===(I=b(d))&&G?G.p(d,R):(G.d(1),G=I(d),G&&(G.c(),G.m(e,null))),R&1080){A=d[5].board;let _;for(_=0;_<A.length;_+=1){const K=de(d,A,_);S[_]?S[_].p(K,R):(S[_]=me(K),S[_].c(),S[_].m(r,null))}for(;_<S.length;_+=1)S[_].d(1);S.length=A.length}if(R&32){W=d[5].chat;let _;for(_=0;_<W.length;_+=1){const K=fe(d,W,_);O[_]?O[_].p(K,R):(O[_]=_e(K),O[_].c(),O[_].m(y,null))}for(;_<O.length;_+=1)O[_].d(1);O.length=W.length}R&64&&D.value!==d[6]&&x(D,d[6]),R&68&&H!==(H=!d[2]||!le(d[6]))&&(F.disabled=H),d[5].winner?M?M.p(d,R):(M=pe(d),M.c(),M.m(w,null)):M&&(M.d(1),M=null)},d(d){d&&i(e),G.d(),d&&i(t),d&&i(l),ce(S,d),ce(O,d),M&&M.d(),N=!1,we(P)}}}function Ue(n){let e;return{c(){e=V("Opponent's turn")},l(t){e=U(t,"Opponent's turn")},m(t,l){C(t,e,l)},p:z,d(t){t&&i(e)}}}function Ce(n){let e;return{c(){e=V("Your turn")},l(t){e=U(t,"Your turn")},m(t,l){C(t,e,l)},p:z,d(t){t&&i(e)}}}function Ge(n){let e;function t(r,c){return r[5].winner==="Draw"?Le:r[5].winner.Win===r[4]?Re:Je}let l=t(n),o=l(n);return{c(){o.c(),e=te()},l(r){o.l(r),e=te()},m(r,c){o.m(r,c),C(r,e,c)},p(r,c){l!==(l=t(r))&&(o.d(1),o=l(r),o&&(o.c(),o.m(e.parentNode,e)))},d(r){o.d(r),r&&i(e)}}}function Me(n){let e;return{c(){e=V("Waiting for opponent...")},l(t){e=U(t,"Waiting for opponent...")},m(t,l){C(t,e,l)},p:z,d(t){t&&i(e)}}}function Je(n){let e;return{c(){e=V("You lost!")},l(t){e=U(t,"You lost!")},m(t,l){C(t,e,l)},d(t){t&&i(e)}}}function Re(n){let e;return{c(){e=V("You won!")},l(t){e=U(t,"You won!")},m(t,l){C(t,e,l)},d(t){t&&i(e)}}}function Le(n){let e;return{c(){e=V("Draw!")},l(t){e=U(t,"Draw!")},m(t,l){C(t,e,l)},d(t){t&&i(e)}}}function me(n){let e,t=n[25]+"",l,o,r,c,m,f;function k(){return n[15](n[27])}return{c(){e=p("button"),l=V(t),o=L(),this.h()},l(a){e=v(a,"BUTTON",{type:!0,class:!0});var u=g(e);l=U(u,t),o=j(u),u.forEach(i),this.h()},h(){h(e,"type","button"),h(e,"class",r="game-square "+n[25]),e.disabled=c=!n[3]||n[5].winner!==null||n[5].turn!==n[4]||n[25]!==" "},m(a,u){C(a,e,u),s(e,l),s(e,o),m||(f=X(e,"click",k),m=!0)},p(a,u){n=a,u&32&&t!==(t=n[25]+"")&&ee(l,t),u&32&&r!==(r="game-square "+n[25])&&h(e,"class",r),u&56&&c!==(c=!n[3]||n[5].winner!==null||n[5].turn!==n[4]||n[25]!==" ")&&(e.disabled=c)},d(a){a&&i(e),m=!1,f()}}}function je(n){var f;let e,t=((f=ve(n[5],n[21].Player))==null?void 0:f.name)+"",l,o,r=n[21].Player+"",c,m;return{c(){e=p("span"),l=V(t),o=V(" ("),c=V(r),m=V("):"),this.h()},l(k){e=v(k,"SPAN",{class:!0});var a=g(e);l=U(a,t),o=U(a," ("),c=U(a,r),m=U(a,"):"),a.forEach(i),this.h()},h(){h(e,"class","chat-message-player")},m(k,a){C(k,e,a),s(e,l),s(e,o),s(e,c),s(e,m)},p(k,a){var u;a&32&&t!==(t=((u=ve(k[5],k[21].Player))==null?void 0:u.name)+"")&&ee(l,t),a&32&&r!==(r=k[21].Player+"")&&ee(c,r)},d(k){k&&i(e)}}}function Ye(n){let e,t;return{c(){e=p("span"),t=V("Server:"),this.h()},l(l){e=v(l,"SPAN",{class:!0});var o=g(e);t=U(o,"Server:"),o.forEach(i),this.h()},h(){h(e,"class","chat-message-server")},m(l,o){C(l,e,o),s(e,t)},p:z,d(l){l&&i(e)}}}function _e(n){let e,t,l,o=n[22]+"",r,c,m;function f(u,y){return u[21]==="System"?Ye:je}let k=f(n),a=k(n);return{c(){e=p("div"),a.c(),t=L(),l=p("span"),r=V(o),c=L(),this.h()},l(u){e=v(u,"DIV",{class:!0,id:!0});var y=g(e);a.l(y),t=j(y),l=v(y,"SPAN",{class:!0});var T=g(l);r=U(T,o),T.forEach(i),c=j(y),y.forEach(i),this.h()},h(){h(l,"class","chat-message-text"),h(e,"class","chat-message"),h(e,"id",m=`chat-message-${n[20]}`)},m(u,y){C(u,e,y),a.m(e,null),s(e,t),s(e,l),s(l,r),s(e,c)},p(u,y){k===(k=f(u))&&a?a.p(u,y):(a.d(1),a=k(u),a&&(a.c(),a.m(e,t))),y&32&&o!==(o=u[22]+"")&&ee(r,o),y&32&&m!==(m=`chat-message-${u[20]}`)&&h(e,"id",m)},d(u){u&&i(e),a.d()}}}function pe(n){let e,t,l,o,r;return{c(){e=p("div"),t=p("button"),l=V("Rematch"),this.h()},l(c){e=v(c,"DIV",{class:!0});var m=g(e);t=v(m,"BUTTON",{type:!0});var f=g(t);l=U(f,"Rematch"),f.forEach(i),m.forEach(i),this.h()},h(){h(t,"type","button"),h(e,"class","column")},m(c,m){C(c,e,m),s(e,t),s(t,l),o||(r=X(t,"click",n[11]),o=!0)},p:z,d(c){c&&i(e),o=!1,r()}}}function Ae(n){let e,t,l,o,r,c,m,f,k,a,u,y=n[2]?"Code For Others to Join You":"Game Name",T,E,w,J,D,Y,B,F;function H(b,I){return b[2]?Ve:Oe}let q=H(n),N=q(n),P=n[2]&&he(n);return{c(){e=p("div"),t=p("form"),l=p("div"),o=p("div"),r=p("label"),c=V("Player Name"),m=L(),f=p("input"),k=L(),a=p("div"),u=p("label"),T=V(y),E=L(),w=p("input"),J=L(),N.c(),D=L(),P&&P.c(),Y=te(),this.h()},l(b){e=v(b,"DIV",{id:!0});var I=g(e);t=v(I,"FORM",{id:!0});var G=g(t);l=v(G,"DIV",{class:!0});var A=g(l);o=v(A,"DIV",{class:!0});var S=g(o);r=v(S,"LABEL",{for:!0});var W=g(r);c=U(W,"Player Name"),W.forEach(i),m=j(S),f=v(S,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),S.forEach(i),k=j(A),a=v(A,"DIV",{class:!0});var O=g(a);u=v(O,"LABEL",{for:!0});var M=g(u);T=U(M,y),M.forEach(i),E=j(O),w=v(O,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),O.forEach(i),J=j(A),N.l(A),A.forEach(i),G.forEach(i),I.forEach(i),D=j(b),P&&P.l(b),Y=te(),this.h()},h(){h(r,"for","player-name"),h(f,"type","text"),h(f,"id","player-name"),h(f,"name","name"),h(f,"placeholder","Player Name"),f.readOnly=n[2],h(o,"class","column"),h(u,"for","join-token"),h(w,"type","text"),h(w,"id","join-token"),h(w,"name","token"),h(w,"placeholder","Game Name (leave blank for random)"),w.readOnly=n[2],h(a,"class","column"),h(l,"class","row"),h(t,"id","join-game-form"),h(e,"id","menu")},m(b,I){C(b,e,I),s(e,t),s(t,l),s(l,o),s(o,r),s(r,c),s(o,m),s(o,f),x(f,n[1]),s(l,k),s(l,a),s(a,u),s(u,T),s(a,E),s(a,w),x(w,n[0]),s(l,J),N.m(l,null),C(b,D,I),P&&P.m(b,I),C(b,Y,I),B||(F=[X(f,"input",n[12]),X(w,"click",n[13]),X(w,"input",n[14]),X(t,"submit",ye(n[7]))],B=!0)},p(b,[I]){I&4&&(f.readOnly=b[2]),I&2&&f.value!==b[1]&&x(f,b[1]),I&4&&y!==(y=b[2]?"Code For Others to Join You":"Game Name")&&ee(T,y),I&4&&(w.readOnly=b[2]),I&1&&w.value!==b[0]&&x(w,b[0]),q===(q=H(b))&&N?N.p(b,I):(N.d(1),N=q(b),N&&(N.c(),N.m(l,null))),b[2]?P?P.p(b,I):(P=he(b),P.c(),P.m(Y.parentNode,Y)):P&&(P.d(1),P=null)},i:z,o:z,d(b){b&&i(e),N.d(),b&&i(D),P&&P.d(b),b&&i(Y),B=!1,we(F)}}}function ve(n,e){return n.players.find(t=>t.team===e)}function le(n){return(n||"").replace(/^\s+|\s+$/gm,"").length>0}function Be(n,e,t){let l=null,o="",r="";Ee(()=>{l=new URL(window.location.href),o=`${l.protocol==="https:"?"wss://":"ws://"}${l.host}/ws`,o=o.replace("5173","3000"),t(1,c=l.searchParams.get("name")||""),t(0,r=l.searchParams.get("token")||""),r&&y()});let c="",m=!1,f=!1,k="X",a={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},u=null;function y(){if(m)return;if(!o)throw new Error("socketUrl not set");console.log("Joining game with player name:",c,"and join token:",r);const N=new URL(o);N.searchParams.set("token",r),N.searchParams.set("name",c),u=new WebSocket(N.href),u.onopen=()=>{t(6,E=""),t(2,m=!0)},u.onmessage=P=>{console.debug("Got Msg From Server:",P);const b=JSON.parse(P.data);console.debug("json",b);const I=Object.keys(b)[0].toString(),G=b[I];if(I==="JoinedGame"){const{token:A,team:S,state:W}=G;t(0,r=A),t(5,a=W),t(4,k=S),t(3,f=a.players.length===2),window.history.replaceState({},document.title,`?token=${encodeURIComponent(r)}&name=${encodeURIComponent(c)}`)}else I==="GameState"?(t(5,a=G),t(3,f=a.players.length===2)):I==="Error"?(console.error("Error from server",G),window.alert(G)):console.error("Unknown message type",I)},u.onclose=()=>{t(2,m=!1),t(0,r=""),window.history.replaceState({},document.title,`?name=${encodeURIComponent(c)}`),console.log("disconnected by server")},u.onerror=P=>{console.error("error",P)}}function T(){console.log("Leaving game"),u&&u.close()}let E="";function w(){u&&le(E)&&(u.send(JSON.stringify({ChatMsg:{text:E}})),t(6,E=""))}function J(N){if(u){if(!f){console.warn("not enough players to play");return}if(a.turn!==k){console.warn("not my turn");return}if(a.winner){console.warn("game is over");return}u.send(JSON.stringify({Move:{space:N}}))}}function D(){if(u){if(!a.winner){console.warn("game is not over");return}u.send(JSON.stringify("Rematch"))}}function Y(){c=this.value,t(1,c)}const B=N=>{m&&(N.currentTarget.select(),navigator.clipboard.writeText(r))};function F(){r=this.value,t(0,r)}const H=N=>J(N);function q(){E=this.value,t(6,E)}return[r,c,m,f,k,a,E,y,T,w,J,D,Y,B,F,H,q]}class Fe extends be{constructor(e){super(),ge(this,e,Be,Ae,ke,{})}}function We(n){let e,t,l,o,r,c,m,f,k,a,u,y;return r=new Fe({}),{c(){e=p("div"),t=p("h1"),l=V("Tic Tac Toe"),o=L(),Ie(r.$$.fragment),c=L(),m=p("footer"),f=p("p"),k=V(`Copyright © 2023 William Manahan-Makley |
            `),a=p("a"),u=V("Source Code"),this.h()},l(T){e=v(T,"DIV",{class:!0});var E=g(e);t=v(E,"H1",{});var w=g(t);l=U(w,"Tic Tac Toe"),w.forEach(i),o=j(E),Ne(r.$$.fragment,E),c=j(E),m=v(E,"FOOTER",{});var J=g(m);f=v(J,"P",{});var D=g(f);k=U(D,`Copyright © 2023 William Manahan-Makley |
            `),a=v(D,"A",{href:!0});var Y=g(a);u=U(Y,"Source Code"),Y.forEach(i),D.forEach(i),J.forEach(i),E.forEach(i),this.h()},h(){h(a,"href","https://github.com/wmakley/tictactoe-rs"),h(e,"class","container")},m(T,E){C(T,e,E),s(e,t),s(t,l),s(e,o),Pe(r,e,null),s(e,c),s(e,m),s(m,f),s(f,k),s(f,a),s(a,u),y=!0},p:z,i(T){y||(Se(r.$$.fragment,T),y=!0)},o(T){Te(r.$$.fragment,T),y=!1},d(T){T&&i(e),De(r)}}}class ze extends be{constructor(e){super(),ge(this,e,null,We,ke,{})}}export{ze as default};
