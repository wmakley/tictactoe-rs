import{S as Xe,i as Ke,s as Qe,k as m,q as E,a as C,l as _,m as g,r as I,h as i,c as U,n as u,b as P,G as s,J as se,K as B,L as Ye,u as fe,H as F,M as Ae,N as Ze,o as $e,e as Be,y as xe,z as et,A as tt,g as lt,d as nt,B as rt}from"../chunks/index.f75bb86e.js";function Fe(n,e,t){const l=n.slice();return l[22]=e[t].id,l[23]=e[t].source,l[24]=e[t].text,l}function We(n,e,t){const l=n.slice();return l[27]=e[t],l[29]=t,l}function at(n){let e,t,l;return{c(){e=m("div"),t=m("button"),l=E("Join or Start Game"),this.h()},l(a){e=_(a,"DIV",{class:!0});var r=g(e);t=_(r,"BUTTON",{type:!0,class:!0});var d=g(t);l=I(d,"Join or Start Game"),d.forEach(i),r.forEach(i),this.h()},h(){u(t,"type","submit"),u(t,"class","horizontal-submit"),u(e,"class","column")},m(a,r){P(a,e,r),s(e,t),s(t,l)},p:F,d(a){a&&i(e)}}}function ot(n){let e,t,l,a,r;return{c(){e=m("div"),t=m("button"),l=E("Leave Game"),this.h()},l(d){e=_(d,"DIV",{class:!0});var b=g(e);t=_(b,"BUTTON",{type:!0,class:!0});var v=g(t);l=I(v,"Leave Game"),v.forEach(i),b.forEach(i),this.h()},h(){u(t,"type","button"),u(t,"class","horizontal-submit"),u(e,"class","column")},m(d,b){P(d,e,b),s(e,t),s(t,l),a||(r=B(t,"click",n[8]),a=!0)},p:F,d(d){d&&i(e),a=!1,r()}}}function st(n){let e;return{c(){e=E("Opponent's turn")},l(t){e=I(t,"Opponent's turn")},m(t,l){P(t,e,l)},p:F,d(t){t&&i(e)}}}function it(n){let e;return{c(){e=E("Your turn")},l(t){e=I(t,"Your turn")},m(t,l){P(t,e,l)},p:F,d(t){t&&i(e)}}}function ct(n){let e;function t(r,d){return r[5].winner==="Draw"?ht:r[5].winner.Win===r[4].team?dt:ft}let l=t(n),a=l(n);return{c(){a.c(),e=Be()},l(r){a.l(r),e=Be()},m(r,d){a.m(r,d),P(r,e,d)},p(r,d){l!==(l=t(r))&&(a.d(1),a=l(r),a&&(a.c(),a.m(e.parentNode,e)))},d(r){a.d(r),r&&i(e)}}}function ut(n){let e;return{c(){e=E("Waiting for opponent...")},l(t){e=I(t,"Waiting for opponent...")},m(t,l){P(t,e,l)},p:F,d(t){t&&i(e)}}}function ft(n){let e;return{c(){e=E("You lost!")},l(t){e=I(t,"You lost!")},m(t,l){P(t,e,l)},d(t){t&&i(e)}}}function dt(n){let e;return{c(){e=E("You won!")},l(t){e=I(t,"You won!")},m(t,l){P(t,e,l)},d(t){t&&i(e)}}}function ht(n){let e;return{c(){e=E("Draw!")},l(t){e=I(t,"Draw!")},m(t,l){P(t,e,l)},d(t){t&&i(e)}}}function qe(n){let e,t=n[27]+"",l,a,r,d,b,v;function y(){return n[16](n[29])}return{c(){e=m("button"),l=E(t),a=C(),this.h()},l(c){e=_(c,"BUTTON",{type:!0,class:!0});var f=g(e);l=I(f,t),a=U(f),f.forEach(i),this.h()},h(){u(e,"type","button"),u(e,"class",r="game-square "+n[27]),e.disabled=d=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[27]!==" "},m(c,f){P(c,e,f),s(e,l),s(e,a),b||(v=B(e,"click",y),b=!0)},p(c,f){n=c,f&32&&t!==(t=n[27]+"")&&fe(l,t),f&32&&r!==(r="game-square "+n[27])&&u(e,"class",r),f&56&&d!==(d=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[27]!==" ")&&(e.disabled=d)},d(c){c&&i(e),b=!1,v()}}}function mt(n){var v;let e,t=((v=we(n[5],n[23].Player))==null?void 0:v.name)+"",l,a,r=n[23].Player+"",d,b;return{c(){e=m("span"),l=E(t),a=E(" ("),d=E(r),b=E("):"),this.h()},l(y){e=_(y,"SPAN",{class:!0});var c=g(e);l=I(c,t),a=I(c," ("),d=I(c,r),b=I(c,"):"),c.forEach(i),this.h()},h(){u(e,"class","chat-message-player")},m(y,c){P(y,e,c),s(e,l),s(e,a),s(e,d),s(e,b)},p(y,c){var f;c&32&&t!==(t=((f=we(y[5],y[23].Player))==null?void 0:f.name)+"")&&fe(l,t),c&32&&r!==(r=y[23].Player+"")&&fe(d,r)},d(y){y&&i(e)}}}function _t(n){let e,t;return{c(){e=m("span"),t=E("Server:"),this.h()},l(l){e=_(l,"SPAN",{class:!0});var a=g(e);t=I(a,"Server:"),a.forEach(i),this.h()},h(){u(e,"class","chat-message-server")},m(l,a){P(l,e,a),s(e,t)},p:F,d(l){l&&i(e)}}}function ze(n){let e,t,l,a=n[24]+"",r,d,b;function v(f,h){return f[23]==="System"?_t:mt}let y=v(n),c=y(n);return{c(){e=m("div"),c.c(),t=C(),l=m("span"),r=E(a),d=C(),this.h()},l(f){e=_(f,"DIV",{class:!0,id:!0});var h=g(e);c.l(h),t=U(h),l=_(h,"SPAN",{class:!0});var N=g(l);r=I(N,a),N.forEach(i),d=U(h),h.forEach(i),this.h()},h(){u(l,"class","chat-message-text"),u(e,"class","chat-message"),u(e,"id",b=`chat-message-${n[22]}`)},m(f,h){P(f,e,h),c.m(e,null),s(e,t),s(e,l),s(l,r),s(e,d)},p(f,h){y===(y=v(f))&&c?c.p(f,h):(c.d(1),c=y(f),c&&(c.c(),c.m(e,t))),h&32&&a!==(a=f[24]+"")&&fe(r,a),h&32&&b!==(b=`chat-message-${f[22]}`)&&u(e,"id",b)},d(f){f&&i(e),c.d()}}}function He(n){let e,t,l;return{c(){e=m("input"),this.h()},l(a){e=_(a,"INPUT",{type:!0}),this.h()},h(){u(e,"type","button"),e.value="Rematch!"},m(a,r){P(a,e,r),t||(l=B(e,"click",n[12]),t=!0)},p:F,d(a){a&&i(e),t=!1,l()}}}function pt(n){let e,t,l,a,r,d,b,v,y,c,f,h=n[2]?"Code For Others to Join You":"Game Name",N,M,k,Q,Y,V,W,ie,A,Z,q,ce,S,G,z,H,$,X,ue,x,ee,ne,L,Ee,K,te,de,Ie,he,Ne,Se;function De(o,w){return o[2]?ot:at}let me=De(n),R=me(n);function Te(o,w){return o[3]?o[5].winner?ct:o[5].turn===o[4].team?it:st:ut}let _e=Te(n),j=_e(n),re=n[5].board,D=[];for(let o=0;o<re.length;o+=1)D[o]=qe(We(n,re,o));let ae=n[5].chat,T=[];for(let o=0;o<ae.length;o+=1)T[o]=ze(Fe(n,ae,o));let O=n[5].winner&&He(n);return{c(){e=m("div"),t=m("form"),l=m("div"),a=m("div"),r=m("label"),d=E("Player Name"),b=C(),v=m("input"),y=C(),c=m("div"),f=m("label"),N=E(h),M=C(),k=m("input"),Q=C(),R.c(),Y=C(),V=m("div"),W=m("div"),j.c(),ie=C(),A=m("div"),Z=m("div"),q=m("div");for(let o=0;o<D.length;o+=1)D[o].c();ce=C(),S=m("div"),G=m("div"),z=m("h2"),H=E("Chat"),$=C(),X=m("div");for(let o=0;o<T.length;o+=1)T[o].c();ue=C(),x=m("form"),ee=m("div"),ne=m("div"),L=m("input"),Ee=C(),K=m("div"),te=m("input"),Ie=C(),O&&O.c(),this.h()},l(o){e=_(o,"DIV",{id:!0});var w=g(e);t=_(w,"FORM",{id:!0});var p=g(t);l=_(p,"DIV",{class:!0});var J=g(l);a=_(J,"DIV",{class:!0});var pe=g(a);r=_(pe,"LABEL",{for:!0});var Ve=g(r);d=I(Ve,"Player Name"),Ve.forEach(i),b=U(pe),v=_(pe,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),pe.forEach(i),y=U(J),c=_(J,"DIV",{class:!0});var ve=g(c);f=_(ve,"LABEL",{for:!0});var Oe=g(f);N=I(Oe,h),Oe.forEach(i),M=U(ve),k=_(ve,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),ve.forEach(i),Q=U(J),R.l(J),J.forEach(i),p.forEach(i),w.forEach(i),Y=U(o),V=_(o,"DIV",{class:!0});var be=g(V);W=_(be,"DIV",{class:!0});var Ce=g(W);j.l(Ce),Ce.forEach(i),ie=U(be),A=_(be,"DIV",{class:!0});var ge=g(A);Z=_(ge,"DIV",{class:!0});var Ue=g(Z);q=_(Ue,"DIV",{class:!0});var Ge=g(q);for(let le=0;le<D.length;le+=1)D[le].l(Ge);Ge.forEach(i),Ue.forEach(i),ce=U(ge),S=_(ge,"DIV",{class:!0});var Me=g(S);G=_(Me,"DIV",{id:!0});var oe=g(G);z=_(oe,"H2",{});var Je=g(z);H=I(Je,"Chat"),Je.forEach(i),$=U(oe),X=_(oe,"DIV",{class:!0});var Le=g(X);for(let le=0;le<T.length;le+=1)T[le].l(Le);Le.forEach(i),ue=U(oe),x=_(oe,"FORM",{});var Re=g(x);ee=_(Re,"DIV",{class:!0});var ye=g(ee);ne=_(ye,"DIV",{class:!0});var je=g(ne);L=_(je,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),je.forEach(i),Ee=U(ye),K=_(ye,"DIV",{class:!0});var ke=g(K);te=_(ke,"INPUT",{type:!0}),Ie=U(ke),O&&O.l(ke),ke.forEach(i),ye.forEach(i),Re.forEach(i),oe.forEach(i),Me.forEach(i),ge.forEach(i),be.forEach(i),this.h()},h(){u(r,"for","player-name"),u(v,"type","text"),u(v,"id","player-name"),u(v,"name","name"),u(v,"placeholder","Player Name"),u(a,"class","column"),u(f,"for","join-token"),u(k,"type","text"),u(k,"id","join-token"),u(k,"name","token"),u(k,"placeholder","Game Name (leave blank for random)"),k.readOnly=n[2],u(c,"class","column"),u(l,"class","row"),u(t,"id","join-game-form"),u(e,"id","menu"),u(W,"class","status"),u(q,"class","game-board"),u(Z,"class","column"),u(X,"class","chat-messages"),u(L,"type","text"),u(L,"id","chat-msg"),u(L,"name","msg"),u(L,"placeholder","Message"),u(ne,"class","column"),u(te,"type","submit"),te.value="Send",te.disabled=de=!n[2]||!Pe(n[6]),u(K,"class","column"),u(ee,"class","row"),u(G,"id","chat"),u(S,"class","column"),u(A,"class","row"),u(V,"class",he=n[2]?"":"hidden")},m(o,w){P(o,e,w),s(e,t),s(t,l),s(l,a),s(a,r),s(r,d),s(a,b),s(a,v),se(v,n[1]),s(l,y),s(l,c),s(c,f),s(f,N),s(c,M),s(c,k),se(k,n[0]),s(l,Q),R.m(l,null),P(o,Y,w),P(o,V,w),s(V,W),j.m(W,null),s(V,ie),s(V,A),s(A,Z),s(Z,q);for(let p=0;p<D.length;p+=1)D[p]&&D[p].m(q,null);s(A,ce),s(A,S),s(S,G),s(G,z),s(z,H),s(G,$),s(G,X);for(let p=0;p<T.length;p+=1)T[p]&&T[p].m(X,null);s(G,ue),s(G,x),s(x,ee),s(ee,ne),s(ne,L),se(L,n[6]),s(ee,Ee),s(ee,K),s(K,te),s(K,Ie),O&&O.m(K,null),Ne||(Se=[B(v,"input",n[13]),B(v,"change",n[10]),B(k,"click",n[14]),B(k,"input",n[15]),B(t,"submit",Ye(n[7])),B(L,"input",n[17]),B(x,"submit",Ye(n[9]))],Ne=!0)},p(o,[w]){if(w&2&&v.value!==o[1]&&se(v,o[1]),w&4&&h!==(h=o[2]?"Code For Others to Join You":"Game Name")&&fe(N,h),w&4&&(k.readOnly=o[2]),w&1&&k.value!==o[0]&&se(k,o[0]),me===(me=De(o))&&R?R.p(o,w):(R.d(1),R=me(o),R&&(R.c(),R.m(l,null))),_e===(_e=Te(o))&&j?j.p(o,w):(j.d(1),j=_e(o),j&&(j.c(),j.m(W,null))),w&2104){re=o[5].board;let p;for(p=0;p<re.length;p+=1){const J=We(o,re,p);D[p]?D[p].p(J,w):(D[p]=qe(J),D[p].c(),D[p].m(q,null))}for(;p<D.length;p+=1)D[p].d(1);D.length=re.length}if(w&32){ae=o[5].chat;let p;for(p=0;p<ae.length;p+=1){const J=Fe(o,ae,p);T[p]?T[p].p(J,w):(T[p]=ze(J),T[p].c(),T[p].m(X,null))}for(;p<T.length;p+=1)T[p].d(1);T.length=ae.length}w&64&&L.value!==o[6]&&se(L,o[6]),w&68&&de!==(de=!o[2]||!Pe(o[6]))&&(te.disabled=de),o[5].winner?O?O.p(o,w):(O=He(o),O.c(),O.m(K,null)):O&&(O.d(1),O=null),w&4&&he!==(he=o[2]?"":"hidden")&&u(V,"class",he)},i:F,o:F,d(o){o&&i(e),R.d(),o&&i(Y),o&&i(V),j.d(),Ae(D,o),Ae(T,o),O&&O.d(),Ne=!1,Ze(Se)}}}function we(n,e){return n.players.find(t=>t.id===e)}function Pe(n){return(n||"").replace(/^\s+|\s+$/gm,"").length>0}function vt(n,e,t){let l=null,a="",r="";$e(()=>{l=new URL(window.location.href),a=`${l.protocol==="https:"?"wss://":"ws://"}${l.host}/ws`,a=a.replace("5173","3000"),t(1,d=l.searchParams.get("name")||""),t(0,r=l.searchParams.get("token")||""),r&&N()});let d="",b=!1,v=!1,y=-1,c={id:0,team:"X",name:"",wins:0},f={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},h=null;function N(){if(b)return;if(!a)throw new Error("socketUrl not set");console.log("Joining game with player name:",d,"and join token:",r);const S=new URL(a);S.searchParams.set("token",r),S.searchParams.set("name",d),h=new WebSocket(S.href),h.onopen=()=>{t(6,k=""),t(2,b=!0)},h.onmessage=G=>{console.debug("Got Msg From Server:",G);const z=JSON.parse(G.data);console.debug("json",z);const H=Object.keys(z)[0].toString(),$=z[H];if(H==="JoinedGame"){const{token:X,player_id:ue,state:x}=$;t(0,r=X),t(5,f=x),y=ue,t(4,c=we(f,y)),t(3,v=f.players.length===2),window.history.replaceState({},document.title,`?token=${encodeURIComponent(r)}&name=${encodeURIComponent(d)}`)}else H==="GameState"?(t(5,f=$),t(3,v=f.players.length===2),t(4,c=we(f,y))):H==="Error"?(console.error("Error from server",$),window.alert($)):console.error("Unknown message type",H)},h.onclose=()=>{t(2,b=!1),t(0,r=""),window.history.replaceState({},document.title,`?name=${encodeURIComponent(d)}`),console.log("disconnected by server")},h.onerror=G=>{console.error("error",G)}}function M(){console.log("Leaving game"),h&&h.close()}let k="";function Q(){h&&Pe(k)&&(h.send(JSON.stringify({ChatMsg:{text:k}})),t(6,k=""))}function Y(){!h||!b||!d||h.send(JSON.stringify({ChangeName:{new_name:d}}))}function V(S){if(h){if(!v){console.warn("not enough players to play");return}if(f.turn!==c.team){console.warn("not my turn");return}if(f.winner){console.warn("game is over");return}h.send(JSON.stringify({Move:{space:S}}))}}function W(){if(h){if(!f.winner){console.warn("game is not over");return}h.send(JSON.stringify("Rematch"))}}function ie(){d=this.value,t(1,d)}const A=S=>{b&&(S.currentTarget.select(),navigator.clipboard.writeText(r))};function Z(){r=this.value,t(0,r)}const q=S=>V(S);function ce(){k=this.value,t(6,k)}return[r,d,b,v,c,f,k,N,M,Q,Y,V,W,ie,A,Z,q,ce]}class bt extends Xe{constructor(e){super(),Ke(this,e,vt,pt,Qe,{})}}function gt(n){let e,t,l,a,r,d,b,v,y,c,f,h;return r=new bt({}),{c(){e=m("div"),t=m("h1"),l=E("Tic Tac Toe"),a=C(),xe(r.$$.fragment),d=C(),b=m("footer"),v=m("p"),y=E(`Copyright © 2023 William Manahan-Makley |
            `),c=m("a"),f=E("Source Code"),this.h()},l(N){e=_(N,"DIV",{class:!0});var M=g(e);t=_(M,"H1",{});var k=g(t);l=I(k,"Tic Tac Toe"),k.forEach(i),a=U(M),et(r.$$.fragment,M),d=U(M),b=_(M,"FOOTER",{});var Q=g(b);v=_(Q,"P",{});var Y=g(v);y=I(Y,`Copyright © 2023 William Manahan-Makley |
            `),c=_(Y,"A",{href:!0});var V=g(c);f=I(V,"Source Code"),V.forEach(i),Y.forEach(i),Q.forEach(i),M.forEach(i),this.h()},h(){u(c,"href","https://github.com/wmakley/tictactoe-rs"),u(e,"class","container")},m(N,M){P(N,e,M),s(e,t),s(t,l),s(e,a),tt(r,e,null),s(e,d),s(e,b),s(b,v),s(v,y),s(v,c),s(c,f),h=!0},p:F,i(N){h||(lt(r.$$.fragment,N),h=!0)},o(N){nt(r.$$.fragment,N),h=!1},d(N){N&&i(e),rt(r)}}}class kt extends Xe{constructor(e){super(),Ke(this,e,null,gt,Qe,{})}}export{kt as default};
