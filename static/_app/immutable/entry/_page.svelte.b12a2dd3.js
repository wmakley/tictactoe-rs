import{S as Xe,i as Ke,s as Qe,k as h,q as E,a as O,l as m,m as b,r as I,h as i,c as V,n as c,b as N,G as s,J as se,K,L as Ye,u as fe,H as W,M as Ae,N as Ze,o as $e,e as Be,y as xe,z as et,A as tt,g as lt,d as nt,B as rt}from"../chunks/index.f75bb86e.js";function Fe(n,e,t){const l=n.slice();return l[21]=e[t].id,l[22]=e[t].source,l[23]=e[t].text,l}function We(n,e,t){const l=n.slice();return l[26]=e[t],l[28]=t,l}function at(n){let e,t,l;return{c(){e=h("div"),t=h("button"),l=E("Join or Start Game"),this.h()},l(o){e=m(o,"DIV",{class:!0});var r=b(e);t=m(r,"BUTTON",{type:!0,class:!0});var d=b(t);l=I(d,"Join or Start Game"),d.forEach(i),r.forEach(i),this.h()},h(){c(t,"type","submit"),c(t,"class","horizontal-submit"),c(e,"class","column")},m(o,r){N(o,e,r),s(e,t),s(t,l)},p:W,d(o){o&&i(e)}}}function ot(n){let e,t,l,o,r;return{c(){e=h("div"),t=h("button"),l=E("Leave Game"),this.h()},l(d){e=m(d,"DIV",{class:!0});var g=b(e);t=m(g,"BUTTON",{type:!0,class:!0});var p=b(t);l=I(p,"Leave Game"),p.forEach(i),g.forEach(i),this.h()},h(){c(t,"type","button"),c(t,"class","horizontal-submit"),c(e,"class","column")},m(d,g){N(d,e,g),s(e,t),s(t,l),o||(r=K(t,"click",n[8]),o=!0)},p:W,d(d){d&&i(e),o=!1,r()}}}function st(n){let e;return{c(){e=E("Opponent's turn")},l(t){e=I(t,"Opponent's turn")},m(t,l){N(t,e,l)},p:W,d(t){t&&i(e)}}}function it(n){let e;return{c(){e=E("Your turn")},l(t){e=I(t,"Your turn")},m(t,l){N(t,e,l)},p:W,d(t){t&&i(e)}}}function ut(n){let e;function t(r,d){return r[5].winner==="Draw"?ht:r[5].winner.Win===r[4].team?dt:ft}let l=t(n),o=l(n);return{c(){o.c(),e=Be()},l(r){o.l(r),e=Be()},m(r,d){o.m(r,d),N(r,e,d)},p(r,d){l!==(l=t(r))&&(o.d(1),o=l(r),o&&(o.c(),o.m(e.parentNode,e)))},d(r){o.d(r),r&&i(e)}}}function ct(n){let e;return{c(){e=E("Waiting for opponent...")},l(t){e=I(t,"Waiting for opponent...")},m(t,l){N(t,e,l)},p:W,d(t){t&&i(e)}}}function ft(n){let e;return{c(){e=E("You lost!")},l(t){e=I(t,"You lost!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function dt(n){let e;return{c(){e=E("You won!")},l(t){e=I(t,"You won!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function ht(n){let e;return{c(){e=E("Draw!")},l(t){e=I(t,"Draw!")},m(t,l){N(t,e,l)},d(t){t&&i(e)}}}function qe(n){let e,t=n[26]+"",l,o,r,d,g,p;function y(){return n[15](n[28])}return{c(){e=h("button"),l=E(t),o=O(),this.h()},l(u){e=m(u,"BUTTON",{type:!0,class:!0});var f=b(e);l=I(f,t),o=V(f),f.forEach(i),this.h()},h(){c(e,"type","button"),c(e,"class",r="game-square "+n[26]),e.disabled=d=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[26]!==" "},m(u,f){N(u,e,f),s(e,l),s(e,o),g||(p=K(e,"click",y),g=!0)},p(u,f){n=u,f&32&&t!==(t=n[26]+"")&&fe(l,t),f&32&&r!==(r="game-square "+n[26])&&c(e,"class",r),f&56&&d!==(d=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[26]!==" ")&&(e.disabled=d)},d(u){u&&i(e),g=!1,p()}}}function mt(n){var p;let e,t=((p=we(n[5],n[22].Player))==null?void 0:p.name)+"",l,o,r=n[22].Player+"",d,g;return{c(){e=h("span"),l=E(t),o=E(" ("),d=E(r),g=E("):"),this.h()},l(y){e=m(y,"SPAN",{class:!0});var u=b(e);l=I(u,t),o=I(u," ("),d=I(u,r),g=I(u,"):"),u.forEach(i),this.h()},h(){c(e,"class","chat-message-player")},m(y,u){N(y,e,u),s(e,l),s(e,o),s(e,d),s(e,g)},p(y,u){var f;u&32&&t!==(t=((f=we(y[5],y[22].Player))==null?void 0:f.name)+"")&&fe(l,t),u&32&&r!==(r=y[22].Player+"")&&fe(d,r)},d(y){y&&i(e)}}}function _t(n){let e,t;return{c(){e=h("span"),t=E("Server:"),this.h()},l(l){e=m(l,"SPAN",{class:!0});var o=b(e);t=I(o,"Server:"),o.forEach(i),this.h()},h(){c(e,"class","chat-message-server")},m(l,o){N(l,e,o),s(e,t)},p:W,d(l){l&&i(e)}}}function ze(n){let e,t,l,o=n[23]+"",r,d,g;function p(f,v){return f[22]==="System"?_t:mt}let y=p(n),u=y(n);return{c(){e=h("div"),u.c(),t=O(),l=h("span"),r=E(o),d=O(),this.h()},l(f){e=m(f,"DIV",{class:!0,id:!0});var v=b(e);u.l(v),t=V(v),l=m(v,"SPAN",{class:!0});var P=b(l);r=I(P,o),P.forEach(i),d=V(v),v.forEach(i),this.h()},h(){c(l,"class","chat-message-text"),c(e,"class","chat-message"),c(e,"id",g=`chat-message-${n[21]}`)},m(f,v){N(f,e,v),u.m(e,null),s(e,t),s(e,l),s(l,r),s(e,d)},p(f,v){y===(y=p(f))&&u?u.p(f,v):(u.d(1),u=y(f),u&&(u.c(),u.m(e,t))),v&32&&o!==(o=f[23]+"")&&fe(r,o),v&32&&g!==(g=`chat-message-${f[21]}`)&&c(e,"id",g)},d(f){f&&i(e),u.d()}}}function He(n){let e,t,l;return{c(){e=h("input"),this.h()},l(o){e=m(o,"INPUT",{type:!0}),this.h()},h(){c(e,"type","button"),e.value="Rematch!"},m(o,r){N(o,e,r),t||(l=K(e,"click",n[11]),t=!0)},p:W,d(o){o&&i(e),t=!1,l()}}}function pt(n){let e,t,l,o,r,d,g,p,y,u,f,v=n[2]?"Code For Others to Join You":"Game Name",P,C,k,Q,L,U,q,ie,F,Z,z,G,R,M,j,$,ue,H,ce,le,x,ne,Y,Ee,X,ee,de,Ie,he,Pe,Se;function De(a,w){return a[2]?ot:at}let me=De(n),A=me(n);function Te(a,w){return a[3]?a[5].winner?ut:a[5].turn===a[4].team?it:st:ct}let _e=Te(n),B=_e(n),re=n[5].board,S=[];for(let a=0;a<re.length;a+=1)S[a]=qe(We(n,re,a));let ae=n[5].chat,D=[];for(let a=0;a<ae.length;a+=1)D[a]=ze(Fe(n,ae,a));let T=n[5].winner&&He(n);return{c(){e=h("div"),t=h("form"),l=h("div"),o=h("div"),r=h("label"),d=E("Player Name"),g=O(),p=h("input"),y=O(),u=h("div"),f=h("label"),P=E(v),C=O(),k=h("input"),Q=O(),A.c(),L=O(),U=h("div"),q=h("div"),B.c(),ie=O(),F=h("div"),Z=h("div"),z=h("div");for(let a=0;a<S.length;a+=1)S[a].c();G=O(),R=h("div"),M=h("div"),j=h("h2"),$=E("Chat"),ue=O(),H=h("div");for(let a=0;a<D.length;a+=1)D[a].c();ce=O(),le=h("form"),x=h("div"),ne=h("div"),Y=h("input"),Ee=O(),X=h("div"),ee=h("input"),Ie=O(),T&&T.c(),this.h()},l(a){e=m(a,"DIV",{id:!0});var w=b(e);t=m(w,"FORM",{id:!0});var _=b(t);l=m(_,"DIV",{class:!0});var J=b(l);o=m(J,"DIV",{class:!0});var pe=b(o);r=m(pe,"LABEL",{for:!0});var Oe=b(r);d=I(Oe,"Player Name"),Oe.forEach(i),g=V(pe),p=m(pe,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),pe.forEach(i),y=V(J),u=m(J,"DIV",{class:!0});var ve=b(u);f=m(ve,"LABEL",{for:!0});var Ve=b(f);P=I(Ve,v),Ve.forEach(i),C=V(ve),k=m(ve,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),ve.forEach(i),Q=V(J),A.l(J),J.forEach(i),_.forEach(i),w.forEach(i),L=V(a),U=m(a,"DIV",{class:!0});var be=b(U);q=m(be,"DIV",{class:!0});var Ue=b(q);B.l(Ue),Ue.forEach(i),ie=V(be),F=m(be,"DIV",{class:!0});var ge=b(F);Z=m(ge,"DIV",{class:!0});var Ce=b(Z);z=m(Ce,"DIV",{class:!0});var Ge=b(z);for(let te=0;te<S.length;te+=1)S[te].l(Ge);Ge.forEach(i),Ce.forEach(i),G=V(ge),R=m(ge,"DIV",{class:!0});var Me=b(R);M=m(Me,"DIV",{id:!0});var oe=b(M);j=m(oe,"H2",{});var Je=b(j);$=I(Je,"Chat"),Je.forEach(i),ue=V(oe),H=m(oe,"DIV",{class:!0});var Le=b(H);for(let te=0;te<D.length;te+=1)D[te].l(Le);Le.forEach(i),ce=V(oe),le=m(oe,"FORM",{});var Re=b(le);x=m(Re,"DIV",{class:!0});var ye=b(x);ne=m(ye,"DIV",{class:!0});var je=b(ne);Y=m(je,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),je.forEach(i),Ee=V(ye),X=m(ye,"DIV",{class:!0});var ke=b(X);ee=m(ke,"INPUT",{type:!0}),Ie=V(ke),T&&T.l(ke),ke.forEach(i),ye.forEach(i),Re.forEach(i),oe.forEach(i),Me.forEach(i),ge.forEach(i),be.forEach(i),this.h()},h(){c(r,"for","player-name"),c(p,"type","text"),c(p,"id","player-name"),c(p,"name","name"),c(p,"placeholder","Player Name"),p.readOnly=n[2],c(o,"class","column"),c(f,"for","join-token"),c(k,"type","text"),c(k,"id","join-token"),c(k,"name","token"),c(k,"placeholder","Game Name (leave blank for random)"),k.readOnly=n[2],c(u,"class","column"),c(l,"class","row"),c(t,"id","join-game-form"),c(e,"id","menu"),c(q,"class","status"),c(z,"class","game-board"),c(Z,"class","column"),c(H,"class","chat-messages"),c(Y,"type","text"),c(Y,"id","chat-msg"),c(Y,"name","msg"),c(Y,"placeholder","Message"),c(ne,"class","column"),c(ee,"type","submit"),ee.value="Send",ee.disabled=de=!n[2]||!Ne(n[6]),c(X,"class","column"),c(x,"class","row"),c(M,"id","chat"),c(R,"class","column"),c(F,"class","row"),c(U,"class",he=n[2]?"":"hidden")},m(a,w){N(a,e,w),s(e,t),s(t,l),s(l,o),s(o,r),s(r,d),s(o,g),s(o,p),se(p,n[1]),s(l,y),s(l,u),s(u,f),s(f,P),s(u,C),s(u,k),se(k,n[0]),s(l,Q),A.m(l,null),N(a,L,w),N(a,U,w),s(U,q),B.m(q,null),s(U,ie),s(U,F),s(F,Z),s(Z,z);for(let _=0;_<S.length;_+=1)S[_]&&S[_].m(z,null);s(F,G),s(F,R),s(R,M),s(M,j),s(j,$),s(M,ue),s(M,H);for(let _=0;_<D.length;_+=1)D[_]&&D[_].m(H,null);s(M,ce),s(M,le),s(le,x),s(x,ne),s(ne,Y),se(Y,n[6]),s(x,Ee),s(x,X),s(X,ee),s(X,Ie),T&&T.m(X,null),Pe||(Se=[K(p,"input",n[12]),K(k,"click",n[13]),K(k,"input",n[14]),K(t,"submit",Ye(n[7])),K(Y,"input",n[16]),K(le,"submit",Ye(n[9]))],Pe=!0)},p(a,[w]){if(w&4&&(p.readOnly=a[2]),w&2&&p.value!==a[1]&&se(p,a[1]),w&4&&v!==(v=a[2]?"Code For Others to Join You":"Game Name")&&fe(P,v),w&4&&(k.readOnly=a[2]),w&1&&k.value!==a[0]&&se(k,a[0]),me===(me=De(a))&&A?A.p(a,w):(A.d(1),A=me(a),A&&(A.c(),A.m(l,null))),_e===(_e=Te(a))&&B?B.p(a,w):(B.d(1),B=_e(a),B&&(B.c(),B.m(q,null))),w&1080){re=a[5].board;let _;for(_=0;_<re.length;_+=1){const J=We(a,re,_);S[_]?S[_].p(J,w):(S[_]=qe(J),S[_].c(),S[_].m(z,null))}for(;_<S.length;_+=1)S[_].d(1);S.length=re.length}if(w&32){ae=a[5].chat;let _;for(_=0;_<ae.length;_+=1){const J=Fe(a,ae,_);D[_]?D[_].p(J,w):(D[_]=ze(J),D[_].c(),D[_].m(H,null))}for(;_<D.length;_+=1)D[_].d(1);D.length=ae.length}w&64&&Y.value!==a[6]&&se(Y,a[6]),w&68&&de!==(de=!a[2]||!Ne(a[6]))&&(ee.disabled=de),a[5].winner?T?T.p(a,w):(T=He(a),T.c(),T.m(X,null)):T&&(T.d(1),T=null),w&4&&he!==(he=a[2]?"":"hidden")&&c(U,"class",he)},i:W,o:W,d(a){a&&i(e),A.d(),a&&i(L),a&&i(U),B.d(),Ae(S,a),Ae(D,a),T&&T.d(),Pe=!1,Ze(Se)}}}function we(n,e){return n.players.find(t=>t.id===e)}function Ne(n){return(n||"").replace(/^\s+|\s+$/gm,"").length>0}function vt(n,e,t){let l=null,o="",r="";$e(()=>{l=new URL(window.location.href),o=`${l.protocol==="https:"?"wss://":"ws://"}${l.host}/ws`,o=o.replace("5173","3000"),t(1,d=l.searchParams.get("name")||""),t(0,r=l.searchParams.get("token")||""),r&&P()});let d="",g=!1,p=!1,y=-1,u={id:0,team:"X",name:"",wins:0},f={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},v=null;function P(){if(g)return;if(!o)throw new Error("socketUrl not set");console.log("Joining game with player name:",d,"and join token:",r);const G=new URL(o);G.searchParams.set("token",r),G.searchParams.set("name",d),v=new WebSocket(G.href),v.onopen=()=>{t(6,k=""),t(2,g=!0)},v.onmessage=R=>{console.debug("Got Msg From Server:",R);const M=JSON.parse(R.data);console.debug("json",M);const j=Object.keys(M)[0].toString(),$=M[j];if(j==="JoinedGame"){const{token:ue,player_id:H,state:ce}=$;t(0,r=ue),t(5,f=ce),y=H,t(4,u=we(f,y)),t(3,p=f.players.length===2),window.history.replaceState({},document.title,`?token=${encodeURIComponent(r)}&name=${encodeURIComponent(d)}`)}else j==="GameState"?(t(5,f=$),t(3,p=f.players.length===2),t(4,u=we(f,y))):j==="Error"?(console.error("Error from server",$),window.alert($)):console.error("Unknown message type",j)},v.onclose=()=>{t(2,g=!1),t(0,r=""),window.history.replaceState({},document.title,`?name=${encodeURIComponent(d)}`),console.log("disconnected by server")},v.onerror=R=>{console.error("error",R)}}function C(){console.log("Leaving game"),v&&v.close()}let k="";function Q(){v&&Ne(k)&&(v.send(JSON.stringify({ChatMsg:{text:k}})),t(6,k=""))}function L(G){if(v){if(!p){console.warn("not enough players to play");return}if(f.turn!==u.team){console.warn("not my turn");return}if(f.winner){console.warn("game is over");return}v.send(JSON.stringify({Move:{space:G}}))}}function U(){if(v){if(!f.winner){console.warn("game is not over");return}v.send(JSON.stringify("Rematch"))}}function q(){d=this.value,t(1,d)}const ie=G=>{g&&(G.currentTarget.select(),navigator.clipboard.writeText(r))};function F(){r=this.value,t(0,r)}const Z=G=>L(G);function z(){k=this.value,t(6,k)}return[r,d,g,p,u,f,k,P,C,Q,L,U,q,ie,F,Z,z]}class bt extends Xe{constructor(e){super(),Ke(this,e,vt,pt,Qe,{})}}function gt(n){let e,t,l,o,r,d,g,p,y,u,f,v;return r=new bt({}),{c(){e=h("div"),t=h("h1"),l=E("Tic Tac Toe"),o=O(),xe(r.$$.fragment),d=O(),g=h("footer"),p=h("p"),y=E(`Copyright © 2023 William Manahan-Makley |
            `),u=h("a"),f=E("Source Code"),this.h()},l(P){e=m(P,"DIV",{class:!0});var C=b(e);t=m(C,"H1",{});var k=b(t);l=I(k,"Tic Tac Toe"),k.forEach(i),o=V(C),et(r.$$.fragment,C),d=V(C),g=m(C,"FOOTER",{});var Q=b(g);p=m(Q,"P",{});var L=b(p);y=I(L,`Copyright © 2023 William Manahan-Makley |
            `),u=m(L,"A",{href:!0});var U=b(u);f=I(U,"Source Code"),U.forEach(i),L.forEach(i),Q.forEach(i),C.forEach(i),this.h()},h(){c(u,"href","https://github.com/wmakley/tictactoe-rs"),c(e,"class","container")},m(P,C){N(P,e,C),s(e,t),s(t,l),s(e,o),tt(r,e,null),s(e,d),s(e,g),s(g,p),s(p,y),s(p,u),s(u,f),v=!0},p:W,i(P){v||(lt(r.$$.fragment,P),v=!0)},o(P){nt(r.$$.fragment,P),v=!1},d(P){P&&i(e),rt(r)}}}class kt extends Xe{constructor(e){super(),Ke(this,e,null,gt,Qe,{})}}export{kt as default};
