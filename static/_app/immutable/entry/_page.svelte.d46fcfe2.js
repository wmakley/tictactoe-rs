import{S as Xe,i as Ke,s as Qe,k as m,q as E,a as M,l as _,m as b,r as N,h as u,c as C,n as i,b as P,G as s,J as se,K as B,L as Ye,u as fe,H as F,M as Ae,N as Ze,o as $e,e as Be,y as xe,z as et,A as tt,g as lt,d as nt,B as rt}from"../chunks/index.f75bb86e.js";function Fe(n,e,t){const l=n.slice();return l[22]=e[t].id,l[23]=e[t].source,l[24]=e[t].text,l}function We(n,e,t){const l=n.slice();return l[27]=e[t],l[29]=t,l}function ot(n){let e,t,l;return{c(){e=m("div"),t=m("button"),l=E("Join or Start Game"),this.h()},l(o){e=_(o,"DIV",{class:!0});var r=b(e);t=_(r,"BUTTON",{type:!0,class:!0});var f=b(t);l=N(f,"Join or Start Game"),f.forEach(u),r.forEach(u),this.h()},h(){i(t,"type","submit"),i(t,"class","horizontal-submit"),i(e,"class","column")},m(o,r){P(o,e,r),s(e,t),s(t,l)},p:F,d(o){o&&u(e)}}}function at(n){let e,t,l,o,r;return{c(){e=m("div"),t=m("button"),l=E("Leave Game"),this.h()},l(f){e=_(f,"DIV",{class:!0});var g=b(e);t=_(g,"BUTTON",{type:!0,class:!0});var v=b(t);l=N(v,"Leave Game"),v.forEach(u),g.forEach(u),this.h()},h(){i(t,"type","button"),i(t,"class","horizontal-submit"),i(e,"class","column")},m(f,g){P(f,e,g),s(e,t),s(t,l),o||(r=B(t,"click",n[8]),o=!0)},p:F,d(f){f&&u(e),o=!1,r()}}}function st(n){let e;return{c(){e=E("Opponent's turn")},l(t){e=N(t,"Opponent's turn")},m(t,l){P(t,e,l)},p:F,d(t){t&&u(e)}}}function it(n){let e;return{c(){e=E("Your turn")},l(t){e=N(t,"Your turn")},m(t,l){P(t,e,l)},p:F,d(t){t&&u(e)}}}function ut(n){let e;function t(r,f){return r[5].winner==="Draw"?ht:r[5].winner.Win===r[4].team?dt:ft}let l=t(n),o=l(n);return{c(){o.c(),e=Be()},l(r){o.l(r),e=Be()},m(r,f){o.m(r,f),P(r,e,f)},p(r,f){l!==(l=t(r))&&(o.d(1),o=l(r),o&&(o.c(),o.m(e.parentNode,e)))},d(r){o.d(r),r&&u(e)}}}function ct(n){let e;return{c(){e=E("Waiting for opponent...")},l(t){e=N(t,"Waiting for opponent...")},m(t,l){P(t,e,l)},p:F,d(t){t&&u(e)}}}function ft(n){let e;return{c(){e=E("You lost!")},l(t){e=N(t,"You lost!")},m(t,l){P(t,e,l)},d(t){t&&u(e)}}}function dt(n){let e;return{c(){e=E("You won!")},l(t){e=N(t,"You won!")},m(t,l){P(t,e,l)},d(t){t&&u(e)}}}function ht(n){let e;return{c(){e=E("Draw!")},l(t){e=N(t,"Draw!")},m(t,l){P(t,e,l)},d(t){t&&u(e)}}}function qe(n){let e,t=n[27]+"",l,o,r,f,g,v;function y(){return n[16](n[29])}return{c(){e=m("button"),l=E(t),o=M(),this.h()},l(c){e=_(c,"BUTTON",{type:!0,class:!0});var d=b(e);l=N(d,t),o=C(d),d.forEach(u),this.h()},h(){i(e,"type","button"),i(e,"class",r="game-square "+n[27]),e.disabled=f=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[27]!==" "},m(c,d){P(c,e,d),s(e,l),s(e,o),g||(v=B(e,"click",y),g=!0)},p(c,d){n=c,d&32&&t!==(t=n[27]+"")&&fe(l,t),d&32&&r!==(r="game-square "+n[27])&&i(e,"class",r),d&56&&f!==(f=!n[3]||n[5].winner!==null||n[5].turn!==n[4].team||n[27]!==" ")&&(e.disabled=f)},d(c){c&&u(e),g=!1,v()}}}function mt(n){var v;let e,t=((v=we(n[5],n[23].Player))==null?void 0:v.name)+"",l,o,r=n[23].Player+"",f,g;return{c(){e=m("span"),l=E(t),o=E(" ("),f=E(r),g=E("):"),this.h()},l(y){e=_(y,"SPAN",{class:!0});var c=b(e);l=N(c,t),o=N(c," ("),f=N(c,r),g=N(c,"):"),c.forEach(u),this.h()},h(){i(e,"class","chat-message-player")},m(y,c){P(y,e,c),s(e,l),s(e,o),s(e,f),s(e,g)},p(y,c){var d;c&32&&t!==(t=((d=we(y[5],y[23].Player))==null?void 0:d.name)+"")&&fe(l,t),c&32&&r!==(r=y[23].Player+"")&&fe(f,r)},d(y){y&&u(e)}}}function _t(n){let e,t;return{c(){e=m("span"),t=E("Server:"),this.h()},l(l){e=_(l,"SPAN",{class:!0});var o=b(e);t=N(o,"Server:"),o.forEach(u),this.h()},h(){i(e,"class","chat-message-server")},m(l,o){P(l,e,o),s(e,t)},p:F,d(l){l&&u(e)}}}function ze(n){let e,t,l,o=n[24]+"",r,f,g;function v(d,h){return d[23]==="System"?_t:mt}let y=v(n),c=y(n);return{c(){e=m("div"),c.c(),t=M(),l=m("span"),r=E(o),f=M(),this.h()},l(d){e=_(d,"DIV",{class:!0,id:!0});var h=b(e);c.l(h),t=C(h),l=_(h,"SPAN",{class:!0});var I=b(l);r=N(I,o),I.forEach(u),f=C(h),h.forEach(u),this.h()},h(){i(l,"class","chat-message-text"),i(e,"class","chat-message"),i(e,"id",g=`chat-message-${n[22]}`)},m(d,h){P(d,e,h),c.m(e,null),s(e,t),s(e,l),s(l,r),s(e,f)},p(d,h){y===(y=v(d))&&c?c.p(d,h):(c.d(1),c=y(d),c&&(c.c(),c.m(e,t))),h&32&&o!==(o=d[24]+"")&&fe(r,o),h&32&&g!==(g=`chat-message-${d[22]}`)&&i(e,"id",g)},d(d){d&&u(e),c.d()}}}function He(n){let e,t,l;return{c(){e=m("input"),this.h()},l(o){e=_(o,"INPUT",{type:!0}),this.h()},h(){i(e,"type","button"),e.value="Rematch!"},m(o,r){P(o,e,r),t||(l=B(e,"click",n[12]),t=!0)},p:F,d(o){o&&u(e),t=!1,l()}}}function pt(n){let e,t,l,o,r,f,g,v,y,c,d,h=n[2]?"Code For Others to Join You":"Game Name",I,U,k,Q,Y,O,W,ie,A,Z,q,ue,D,S,z,H,$,X,ce,x,ee,ne,j,Ee,K,te,de,Ne,he,Ie,Pe;function De(a,w){return a[2]?at:ot}let me=De(n),L=me(n);function Te(a,w){return a[3]?a[5].winner?ut:a[5].turn===a[4].team?it:st:ct}let _e=Te(n),R=_e(n),re=n[5].board,T=[];for(let a=0;a<re.length;a+=1)T[a]=qe(We(n,re,a));let oe=n[5].chat,V=[];for(let a=0;a<oe.length;a+=1)V[a]=ze(Fe(n,oe,a));let G=n[5].winner&&He(n);return{c(){e=m("div"),t=m("form"),l=m("div"),o=m("div"),r=m("label"),f=E("Player Name"),g=M(),v=m("input"),y=M(),c=m("div"),d=m("label"),I=E(h),U=M(),k=m("input"),Q=M(),L.c(),Y=M(),O=m("div"),W=m("div"),R.c(),ie=M(),A=m("div"),Z=m("div"),q=m("div");for(let a=0;a<T.length;a+=1)T[a].c();ue=M(),D=m("div"),S=m("div"),z=m("h2"),H=E("Chat"),$=M(),X=m("div");for(let a=0;a<V.length;a+=1)V[a].c();ce=M(),x=m("form"),ee=m("div"),ne=m("div"),j=m("input"),Ee=M(),K=m("div"),te=m("input"),Ne=M(),G&&G.c(),this.h()},l(a){e=_(a,"DIV",{id:!0});var w=b(e);t=_(w,"FORM",{id:!0});var p=b(t);l=_(p,"DIV",{class:!0});var J=b(l);o=_(J,"DIV",{class:!0});var pe=b(o);r=_(pe,"LABEL",{for:!0});var Ve=b(r);f=N(Ve,"Player Name"),Ve.forEach(u),g=C(pe),v=_(pe,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0,maxlength:!0}),pe.forEach(u),y=C(J),c=_(J,"DIV",{class:!0});var ve=b(c);d=_(ve,"LABEL",{for:!0});var Oe=b(d);I=N(Oe,h),Oe.forEach(u),U=C(ve),k=_(ve,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0,maxlength:!0}),ve.forEach(u),Q=C(J),L.l(J),J.forEach(u),p.forEach(u),w.forEach(u),Y=C(a),O=_(a,"DIV",{class:!0});var ge=b(O);W=_(ge,"DIV",{class:!0});var Ge=b(W);R.l(Ge),Ge.forEach(u),ie=C(ge),A=_(ge,"DIV",{class:!0});var be=b(A);Z=_(be,"DIV",{class:!0});var Me=b(Z);q=_(Me,"DIV",{class:!0});var Ce=b(q);for(let le=0;le<T.length;le+=1)T[le].l(Ce);Ce.forEach(u),Me.forEach(u),ue=C(be),D=_(be,"DIV",{class:!0});var Ue=b(D);S=_(Ue,"DIV",{id:!0});var ae=b(S);z=_(ae,"H2",{});var Je=b(z);H=N(Je,"Chat"),Je.forEach(u),$=C(ae),X=_(ae,"DIV",{class:!0});var je=b(X);for(let le=0;le<V.length;le+=1)V[le].l(je);je.forEach(u),ce=C(ae),x=_(ae,"FORM",{});var Le=b(x);ee=_(Le,"DIV",{class:!0});var ye=b(ee);ne=_(ye,"DIV",{class:!0});var Re=b(ne);j=_(Re,"INPUT",{type:!0,id:!0,name:!0,placeholder:!0}),Re.forEach(u),Ee=C(ye),K=_(ye,"DIV",{class:!0});var ke=b(K);te=_(ke,"INPUT",{type:!0}),Ne=C(ke),G&&G.l(ke),ke.forEach(u),ye.forEach(u),Le.forEach(u),ae.forEach(u),Ue.forEach(u),be.forEach(u),ge.forEach(u),this.h()},h(){i(r,"for","player-name"),i(v,"type","text"),i(v,"id","player-name"),i(v,"name","name"),i(v,"placeholder","Player Name"),i(v,"maxlength","32"),i(o,"class","column"),i(d,"for","join-token"),i(k,"type","text"),i(k,"id","join-token"),i(k,"name","token"),i(k,"placeholder","Game Name (leave blank for random)"),i(k,"maxlength","32"),k.readOnly=n[2],i(c,"class","column"),i(l,"class","row"),i(t,"id","join-game-form"),i(e,"id","menu"),i(W,"class","status"),i(q,"class","game-board"),i(Z,"class","column"),i(X,"class","chat-messages"),i(j,"type","text"),i(j,"id","chat-msg"),i(j,"name","msg"),i(j,"placeholder","Message"),i(ne,"class","column"),i(te,"type","submit"),te.value="Send",te.disabled=de=!n[2]||!Se(n[6]),i(K,"class","column"),i(ee,"class","row"),i(S,"id","chat"),i(D,"class","column"),i(A,"class","row"),i(O,"class",he=n[2]?"":"hidden")},m(a,w){P(a,e,w),s(e,t),s(t,l),s(l,o),s(o,r),s(r,f),s(o,g),s(o,v),se(v,n[1]),s(l,y),s(l,c),s(c,d),s(d,I),s(c,U),s(c,k),se(k,n[0]),s(l,Q),L.m(l,null),P(a,Y,w),P(a,O,w),s(O,W),R.m(W,null),s(O,ie),s(O,A),s(A,Z),s(Z,q);for(let p=0;p<T.length;p+=1)T[p]&&T[p].m(q,null);s(A,ue),s(A,D),s(D,S),s(S,z),s(z,H),s(S,$),s(S,X);for(let p=0;p<V.length;p+=1)V[p]&&V[p].m(X,null);s(S,ce),s(S,x),s(x,ee),s(ee,ne),s(ne,j),se(j,n[6]),s(ee,Ee),s(ee,K),s(K,te),s(K,Ne),G&&G.m(K,null),Ie||(Pe=[B(v,"input",n[13]),B(v,"change",n[10]),B(k,"click",n[14]),B(k,"input",n[15]),B(t,"submit",Ye(n[7])),B(j,"input",n[17]),B(x,"submit",Ye(n[9]))],Ie=!0)},p(a,[w]){if(w&2&&v.value!==a[1]&&se(v,a[1]),w&4&&h!==(h=a[2]?"Code For Others to Join You":"Game Name")&&fe(I,h),w&4&&(k.readOnly=a[2]),w&1&&k.value!==a[0]&&se(k,a[0]),me===(me=De(a))&&L?L.p(a,w):(L.d(1),L=me(a),L&&(L.c(),L.m(l,null))),_e===(_e=Te(a))&&R?R.p(a,w):(R.d(1),R=_e(a),R&&(R.c(),R.m(W,null))),w&2104){re=a[5].board;let p;for(p=0;p<re.length;p+=1){const J=We(a,re,p);T[p]?T[p].p(J,w):(T[p]=qe(J),T[p].c(),T[p].m(q,null))}for(;p<T.length;p+=1)T[p].d(1);T.length=re.length}if(w&32){oe=a[5].chat;let p;for(p=0;p<oe.length;p+=1){const J=Fe(a,oe,p);V[p]?V[p].p(J,w):(V[p]=ze(J),V[p].c(),V[p].m(X,null))}for(;p<V.length;p+=1)V[p].d(1);V.length=oe.length}w&64&&j.value!==a[6]&&se(j,a[6]),w&68&&de!==(de=!a[2]||!Se(a[6]))&&(te.disabled=de),a[5].winner?G?G.p(a,w):(G=He(a),G.c(),G.m(K,null)):G&&(G.d(1),G=null),w&4&&he!==(he=a[2]?"":"hidden")&&i(O,"class",he)},i:F,o:F,d(a){a&&u(e),L.d(),a&&u(Y),a&&u(O),R.d(),Ae(T,a),Ae(V,a),G&&G.d(),Ie=!1,Ze(Pe)}}}function we(n,e){return n.players.find(t=>t.id===e)}function Se(n){const e=(n||"").replace(/^\s+|\s+$/gm,"");return e.length>0&&e.length<=500}function vt(n,e,t){let l=null,o="",r="";$e(()=>{if(l=new URL(window.location.href),o=`${l.protocol==="https:"?"wss://":"ws://"}${l.host}/ws`,o=o.replace("5173","3000"),t(1,f=localStorage.getItem("playerName")||""),console.debug("playerName",f),f.length>32&&(console.error("playerName too long"),t(1,f=f.slice(0,32))),t(0,r=l.searchParams.get("token")||""),r){if(r.length>32){console.error("joinToken too long"),t(0,r="");return}I()}});let f="",g=!1,v=!1,y=-1,c={id:0,team:"X",name:"",wins:0},d={turn:"X",winner:null,players:[],board:[" "," "," "," "," "," "," "," "," "],chat:[]},h=null;function I(){if(g)return;if(!o)throw new Error("socketUrl not set");console.log("Joining game with player name:",f,"and join token:",r);const D=new URL(o);D.searchParams.set("token",r),D.searchParams.set("name",f),h=new WebSocket(D.href),h.onopen=()=>{t(6,k=""),t(2,g=!0)},h.onmessage=S=>{console.debug("Got Msg From Server:",S);const z=JSON.parse(S.data);console.debug("json",z);const H=Object.keys(z)[0].toString(),$=z[H];if(H==="JoinedGame"){const{token:X,player_id:ce,state:x}=$;t(0,r=X),t(5,d=x),y=ce,t(4,c=we(d,y)),t(3,v=d.players.length===2),window.history.replaceState({},document.title,`?token=${encodeURIComponent(r)}`)}else H==="GameState"?(t(5,d=$),t(3,v=d.players.length===2),t(4,c=we(d,y))):H==="Error"?(console.error("Error from server",$),window.alert($)):console.error("Unknown message type",H)},h.onclose=()=>{var S;t(2,g=!1),console.log("disconnected by server"),h=null,(S=document.getElementById("join-token"))==null||S.select()},h.onerror=S=>{console.error("error",S)}}function U(){console.log("Leaving game"),h&&h.close()}let k="";function Q(){h&&Se(k)&&(h.send(JSON.stringify({ChatMsg:{text:k}})),t(6,k=""))}function Y(){localStorage.setItem("playerName",f),f&&(!h||!g||h.send(JSON.stringify({ChangeName:{new_name:f}})))}function O(D){if(h){if(!v){console.warn("not enough players to play");return}if(d.turn!==c.team){console.warn("not my turn");return}if(d.winner){console.warn("game is over");return}h.send(JSON.stringify({Move:{space:D}}))}}function W(){if(h){if(!d.winner){console.warn("game is not over");return}h.send(JSON.stringify("Rematch"))}}function ie(){f=this.value,t(1,f)}const A=D=>{g&&(D.currentTarget.select(),navigator.clipboard.writeText(r))};function Z(){r=this.value,t(0,r)}const q=D=>O(D);function ue(){k=this.value,t(6,k)}return[r,f,g,v,c,d,k,I,U,Q,Y,O,W,ie,A,Z,q,ue]}class gt extends Xe{constructor(e){super(),Ke(this,e,vt,pt,Qe,{})}}function bt(n){let e,t,l,o,r,f,g,v,y,c,d,h;return r=new gt({}),{c(){e=m("div"),t=m("h1"),l=E("Tic Tac Toe"),o=M(),xe(r.$$.fragment),f=M(),g=m("footer"),v=m("p"),y=E(`Copyright © 2023 William Manahan-Makley |
            `),c=m("a"),d=E("Source Code"),this.h()},l(I){e=_(I,"DIV",{class:!0});var U=b(e);t=_(U,"H1",{});var k=b(t);l=N(k,"Tic Tac Toe"),k.forEach(u),o=C(U),et(r.$$.fragment,U),f=C(U),g=_(U,"FOOTER",{});var Q=b(g);v=_(Q,"P",{});var Y=b(v);y=N(Y,`Copyright © 2023 William Manahan-Makley |
            `),c=_(Y,"A",{href:!0});var O=b(c);d=N(O,"Source Code"),O.forEach(u),Y.forEach(u),Q.forEach(u),U.forEach(u),this.h()},h(){i(c,"href","https://github.com/wmakley/tictactoe-rs"),i(e,"class","container")},m(I,U){P(I,e,U),s(e,t),s(t,l),s(e,o),tt(r,e,null),s(e,f),s(e,g),s(g,v),s(v,y),s(v,c),s(c,d),h=!0},p:F,i(I){h||(lt(r.$$.fragment,I),h=!0)},o(I){nt(r.$$.fragment,I),h=!1},d(I){I&&u(e),rt(r)}}}class kt extends Xe{constructor(e){super(),Ke(this,e,null,bt,Qe,{})}}export{kt as default};
